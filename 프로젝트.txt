1. í”„ë¡œì íŠ¸ í™˜ê²½ì„¤ì •

#1.ì¸ê°•/jpaí™œìš©í¸/í™œìš©í¸1/ê°•ì˜

/í”„ë¡œì íŠ¸ ìƒì„±

/ë¼ğŸ•”ë¸ŒëŸ¬ë¦¬ ì‚´í´ë³´ê¸°

/View í™˜ê²½ ì„¤ì •

/H2 ë°ğŸ•”í„°ë² ğŸ•”ìŠ¤ ì„¤ì¹˜

/JPAì™€ DB ì„¤ì •, ë™ì‘í™•ì¸

í”„ë¡œì íŠ¸ ìƒì„±

ìŠ¤í”„ë§ ë¶€íŠ¸ ìŠ¤íƒ€í„°(https://start.spring.io/)

Project: **Gradle - Groovy**                   Project

ì‚¬ìš© ê¸°ëŠ¥: web, thymeleaf, jpa, h2, lombok, validation
groupId: jpabook

artifactId: jpashop

ì£¼ì˜! - ìŠ¤í”„ë§ ë¶€íŠ¸ 3.x ë²„ì „ ì„ íƒ í•„ìˆ˜

**start.spring.io ì‚¬ì´íŠ¸ì—ì„œ ìŠ¤í”„ë§ ë¶€íŠ¸ 2.xì— ëŒ€í•œ ì§€ì›ì´ ì¢…ë£Œë˜ì–´ì„œ ë”ëŠ” ì„ íƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.**

**ì´ì œëŠ” ìŠ¤í”„ë§ ë¶€íŠ¸ 3.0 ì´ìƒì„ ì„ íƒí•´ì£¼ì„¸ìš”.**

ìŠ¤í”„ë§ ë¶€íŠ¸ 3.0ì„ ì„ íƒí•˜ê²Œ ë˜ë©´ ë‹¤ìŒ ë¶€ë¶„ì„ ê¼­ í™•ì¸í•´ì£¼ì„¸ìš”.

**1. Java 17 ì´ìƒ**ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

**2. javax íŒ¨í‚¤ì§€ ì´ë¦„ì„ jakartaë¡œ ë³€ê²½**í•´ì•¼ í•©ë‹ˆë‹¤.

ì˜¤ë¼í´ê³¼ ìë°” ë¼ğŸ•”ì„¼ìŠ¤ ë¬¸ì œë¡œ ëª¨ë“  javax íŒ¨í‚¤ì§€ë¥¼ jakarta ë¡œ ë³€ê²½í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.

**3. H2 ë°ì´í„°ë² ì´ìŠ¤ë¥¼ 2.1.214 ë²„ì „ ì´ìƒ ì‚¬ìš©í•´ì£¼ì„¸ìš”.**

**íŒ¨í‚¤ì§€ ì´ë¦„ ë³€ê²½ ì˜ˆ)**

**JPA ì• ë…¸í…Œì´ì…˜**

javax.persistence.Entity     jakarta.persistence.Entity

**ìŠ¤í”„ë§ì—ì„œ ìì£¼ ì‚¬ìš©í•˜ëŠ” @PostConstruct ì• ë…¸í…Œì´ì…˜**

javax.annotation.PostConstruct     jakarta.annotation.PostConstruct

**ìŠ¤í”„ë§ì—ì„œ ìì£¼ ì‚¬ìš©í•˜ëŠ” ê²€ì¦ ì• ë…¸í…Œì´ì…˜**

javax.validation     jakarta.validation


ìŠ¤í”„ë§ ë¶€íŠ¸ 3.0 ê´€ë ¨ ìì„¸í•œ ë‚´ìš©ì€ ë‹¤ìŒ ë§í¬ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”: https://bit.ly/springboot3

**ìŠ¤í”„ë§ ë¶€íŠ¸ ìŠ¤íƒ€í„° ì„¤ì • í•„ë…! ì£¼ì˜!**

ìŠ¤í”„ë§ ë¶€íŠ¸ ë²„ì „ì€ 3.x.x ë²„ì „ì„ ì„ íƒí•´ì£¼ì„¸ìš”.
ìë°” ë²„ì „ì€ 17 ë˜ëŠ” 21ì„ ì„ íƒí•´ì£¼ì„¸ìš”.

Validation (JSR-303 validation with Hibernate validator) ëª¨ë“ˆì„ ê¼­! ì¶”ê°€í•´ì£¼ì„¸ìš”.(ì˜ìƒì— ì—†ìŠµë‹ˆë‹¤.)

**í•„ë…! ì£¼ì˜!**

ì˜ ì•ˆë˜ë©´ ë‹¤ìŒì— ë‚˜ì˜¤ëŠ” build.gradle íŒŒì¼ì„ ê·¸ëŒ€ë¡œ ë³µì‚¬í•´ì„œ ì‚¬ìš©í•´ì£¼ì„¸ìš”. ê°•ì˜ ì˜ìƒê³¼ ì°¨ğŸ•”ê°€ ìˆìŠµë‹ˆë‹¤.

ìŠ¤í”„ë§ ë¶€íŠ¸ ë²„ì „ğŸ•” 2.1.x     3.2.xìœ¼ë¡œ ì—…ê·¸ë ˆğŸ•”ë“œ ë˜ì—ˆìŠµë‹ˆë‹¤.

validation ëª¨ë“ˆğŸ•” ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤. (ìµœì‹  ìŠ¤í”„ë§ ë¶€íŠ¸ì—ì„œëŠ” ì§ì ‘ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.)
ìë°” ë²„ì „ğŸ•” 1.8     17ë¡œ ì—…ê·¸ë ˆğŸ•”ë“œ ë˜ì—ˆìŠµë‹ˆë‹¤.

build.gradle Gradle ì „ì²´ ì„¤ì •

```grvy

plugins {

id 'java'

id 'org.springframework.boot' version '3.2.0'

id 'io.spring.dependency-management' version '1.1.4'

}

group = 'jpabook'

version = '0.0.1-SNAPSHOT'

java {

sourceCompatibility = '17'

}

configurations {
compileOnly {

extendsFrom annotationProcessor

}

}

repositories {
mavenCentral()

}


dependencies {

implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
implementation 'org.springframework.boot:spring-boot-starter-thymeleaf'
implementation 'org.springframework.boot:spring-boot-starter-validation'
implementation 'org.springframework.boot:spring-boot-starter-web'

compileOnly 'org.projectlombok:lombok'
runtimeOnly 'com.h2database:h2'

annotationProcessor 'org.projectlombok:lombok'

testImplementation 'org.springframework.boot:spring-boot-starter-test'

//JUnit4 ì¶”ê°€

testImplementation("org.junit.vintage:junit-vintage-engine") {
exclude group: "org.hamcrest", module: "hamcrest-core"

}

}

tasks.named('test') {
useJUnitPlatform()

}

```

**í•„ë…! ì£¼ì˜!**

ê°•ì˜ ì˜ìƒğŸ•” JUnit4ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•˜ê¸° ë•Œë¬¸ì— build.gradle ì— ìˆëŠ” ë‹¤ìŒ ë¶€ë¶„ì„ ê¼­ ì§ì ‘ ì¶”ê°€í•´ì£¼ì„¸ìš”.
í•´ë‹¹ ë¶€ë¶„ì„ ì…ë ¥í•˜ì§€ ì•Šìœ¼ë©´ JUnit5ë¡œ ë™ì‘í•©ë‹ˆë‹¤. JUnit5ë¥¼ ì˜ ì•Œê³  ì„ í˜¸í•˜ì‹œë©´ ì…ë ¥í•˜ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤.

```

//JUnit4 ì¶”ê°€

testImplementation("org.junit.vintage:junit-vintage-engine") {
exclude group: "org.hamcrest", module: "hamcrest-core"

}

```

ë™ì‘ í™•ì¸

ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ì¼€ğŸ•”ìŠ¤ ì‹¤í–‰

ìŠ¤í”„ë§ ë¶€íŠ¸ ë©”ì¸ ì‹¤í–‰ í›„ ì—ëŸ¬í˜ğŸ•”ì§€ë¡œ ê°„ë‹¨í•˜ê²Œ ë™ì‘ í™•ì¸(`http://localhost:8080')

ë¡¬ë³µ ì ìš©

1.   Preferences     plugin     lombok ê²€ìƒ‰ ì‹¤í–‰ (ì¬ì‹œì‘)

2.   Preferences     Annotation Processors ê²€ìƒ‰    Enable annotation processing ì²´í¬ (ì¬ì‹œì‘)

3.   ì„ì˜ì˜ í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ê³  @Getter, @Setter í™•ì¸


ì£¼ì˜! ìŠ¤í”„ë§ ë¶€íŠ¸ 3.2ë¶€í„° JDK 17ê³¼ Gradle ì˜µì…˜ì„ ì„ íƒí•˜ì.

ìŠ¤í”„ë§ ë¶€íŠ¸ 3.2 ë¶€í„° JDK 17 ğŸ•”ìƒê³¼, ë¹Œë“œì‹œ IntelliJ IDEAê°€ ì•„ë‹ˆë¼ Gradleì„ ì„ íƒí•´ì•¼ í•œë‹¤.

**í”„ë¡œì íŠ¸ JDK ì„¤ì •**

ë‹¤ìŒìœ¼ë¡œ ğŸ•”ë™í•©ë‹ˆë‹¤.

Windows: File     Project Structure(Ctrl+Alt+Shift+S)
Mac: File     Project Structure (âŒ˜;)

íŒŒë€ ë°•ìŠ¤ì˜ JDKë¥¼ ë‚´ê°€ ìƒˆë¡œ ì„¤ì¹˜í•œ **ìë°” 17ë¡œ ì§€ì •**í•´ì¤ë‹ˆë‹¤.


ë‹¤ìŒìœ¼ë¡œ ğŸ•”ë™í•©ë‹ˆë‹¤.

Windows: File     Settings(Ctrl+Alt+S)
Mac: IntelliJ IDEA | Preferences(âŒ˜,)

Preferences     Build, Execution, Deployment     Build Tools     Gradle

**ë¹¨ê°„ìƒ‰ ë°•ìŠ¤ì˜ Build and run usingë¥¼ Gradleë¡œ ì„ íƒí•©ë‹ˆë‹¤.**

**ë¹¨ê°„ìƒ‰ ë°•ìŠ¤ì˜ Build tests usingë¥¼ Gradleë¡œ ì„ íƒí•©ë‹ˆë‹¤.**

ë¹¨ê°„ìƒ‰ ë°•ìŠ¤ Gradle JVMì„ ìƒˆë¡œ ì„¤ì¹˜í•œ **ìë°” 17ë˜ëŠ” ê·¸ ì´ìƒìœ¼ë¡œ ì§€ì •í•©ë‹ˆë‹¤.**

ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚´í´ë³´ê¸°

**gradle ì˜ì¡´ê´€ê³„ ë³´ê¸°**

./gradlew dependencies â€”configuration compileClasspath

**ìŠ¤í”„ë§ ë¶€íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚´í´ë³´ê¸°**


spring-boot-starter-web

spring-boot-starter-tomcat: í†°ìº£ (ì›¹ì„œë²„)
spring-webmvc: ìŠ¤í”„ë§ ì›¹ MVC

spring-boot-starter-thymeleaf: íƒ€ì„ë¦¬í”„ í…œí”Œë¦¿ ì—”ì§„(View)
spring-boot-starter-data-jpa

spring-boot-starter-aop
spring-boot-starter-jdbc

HikariCP ì»¤ë„¥ì…˜ í’€ (ë¶€íŠ¸ 2.0 ê¸°ë³¸)

hibernate + JPA: í•˜ğŸ•”ë²„ë„¤ğŸ•”íŠ¸ + JPA
spring-data-jpa: ìŠ¤í”„ë§ ë°ğŸ•”í„° JPA

spring-boot-starter(ê³µí†µ): ìŠ¤í”„ë§ ë¶€íŠ¸ + ìŠ¤í”„ë§ ì½”ì–´ + ë¡œê¹…

spring-boot

spring-core

spring-boot-starter-logging
logback, slf4j

**í…ŒìŠ¤íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬**

spring-boot-starter-test
junit: í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬

mockito: ëª© ë¼ğŸ•”ë¸ŒëŸ¬ë¦¬

assertj: í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì¢€ ë” í¸í•˜ê²Œ ì‘ì„±í•˜ê²Œ ë„ì™€ì£¼ëŠ” ë¼ğŸ•”ë¸ŒëŸ¬ë¦¬

spring-test: ìŠ¤í”„ë§ í†µí•© í…ŒìŠ¤íŠ¸ ì§€ì›

í•µì‹¬ ë¼ğŸ•”ë¸ŒëŸ¬ë¦¬

ìŠ¤í”„ë§ MVC

ìŠ¤í”„ë§ ORM

JPA, í•˜ğŸ•”ë²„ë„¤ğŸ•”íŠ¸
ìŠ¤í”„ë§ ë°ğŸ•”í„° JPA

ê¸°íƒ€ ë¼ğŸ•”ë¸ŒëŸ¬ë¦¬

H2 ë°ğŸ•”í„°ë² ğŸ•”ìŠ¤ í´ë¼ğŸ•”ì–¸íŠ¸
ì»¤ë„¥ì…˜ í’€: ë¶€íŠ¸ ê¸°ë³¸ì€ HikariCP
WEB(thymeleaf)

ë¡œê¹… SLF4J & LogBack

í…ŒìŠ¤íŠ¸

ì°¸ê³ : ìŠ¤í”„ë§ ë°ğŸ•”í„° JPAëŠ” ìŠ¤í”„ë§ê³¼ JPAë¥¼ ë¨¼ì € ğŸ•”í•´í•˜ê³  ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ì‘ìš©ê¸°ìˆ ğŸ•”ë‹¤.


View í™˜ê²½ ì„¤ì •

**thymeleaf í…œí”Œë¦¿ ì—”ì§„**

thymeleaf ê³µì‹ ì‚¬ğŸ•”íŠ¸:  https://www.thymeleaf.org/

ìŠ¤í”„ë§ ê³µì‹ íŠœí† ë¦¬ì–¼: https://spring.io/guides/gs/serving-web-content/

ìŠ¤í”„ë§ë¶€íŠ¸ ë©”ë‰´ì–¼: https://docs.spring.io/spring-boot/docs/2.1.6.RELEASE/reference/html/
boot-features-developing-web-applications.html#boot-features-spring-mvc-template-engines

ìŠ¤í”„ë§ ë¶€íŠ¸ thymeleaf viewName ë§¤í•‘

resources:templates/ +{ViewName}+  .html

**jpabook.jpashop.HelloController**

```

@Controller

public class HelloController {

@GetMapping("hello")

public String hello(Model model) {
model.addAttribute("data", "hello!!");
return            "hello";

}

}

```

**thymeleaf í…œí”Œë¦¿ì—”ì§„ ë™ì‘ í™•ì¸(hello.html)**

```html

<!DOCTYPE HTML>

<html xmlns:th="http://www.thymeleaf.org">

<head>

<title>Hello</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

</head>

<body>

<p th:text="'ì•ˆë…•í•˜ì„¸ìš”. ' + ${data}" >ì•ˆë…•í•˜ì„¸ìš”. ì†ë‹˜</p>

</body>

</html>

```

ìœ„ì¹˜:  resources/templates/hello.html

index.html í•˜ë‚˜ ë§Œë“¤ê¸°

static/index.html


```html

<!DOCTYPE HTML>

<html xmlns:th="http://www.thymeleaf.org">

<head>

<title>Hello</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

</head>

<body>
Hello

<a href="/hello">hello</a>

</body>

</html>

```

ì°¸ê³ :  spring-boot-devtools ë¼ğŸ•”ë¸ŒëŸ¬ë¦¬ë¥¼ ì¶”ê°€í•˜ë©´,  html íŒŒì¼ì„ ì»´íŒŒì¼ë§Œ í•´ì£¼ë©´ ì„œë²„ ì¬ì‹œì‘ ì—†ğŸ•”

View íŒŒì¼ ë³€ê²½ğŸ•” ê°€ëŠ¥í•˜ë‹¤.

ì¸í…”ë¦¬J ì»´íŒŒì¼ ë°©ë²•: ë©”ë‰´ build     Recompile

H2 ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì¹˜

ê°œë°œğŸ•”ë‚˜ í…ŒìŠ¤íŠ¸ ìš©ë„ë¡œ ê°€ë³ê³  í¸ë¦¬í•œ DB, ì›¹ í™”ë©´ ì œê³µ

https://www.h2database.com

ë‹¤ìš´ë¡œë“œ ë° ì„¤ì¹˜

ìŠ¤í”„ë§ ë¶€íŠ¸ 2.xë¥¼ ì‚¬ìš©í•˜ë©´ **1.4.200 ë²„ì „**ì„ ë‹¤ìš´ë¡œë“œ ë°›ìœ¼ë©´ ëœë‹¤.
ìŠ¤í”„ë§ ë¶€íŠ¸ 3.xë¥¼ ì‚¬ìš©í•˜ë©´ **2.1.214 ë²„ì „ ì´ìƒ**                   ì‚¬ìš©í•´ì•¼ í•œë‹¤.

ë°ğŸ•”í„°ë² ğŸ•”ìŠ¤ íŒŒì¼ ìƒì„± ë°©ë²•

jdbc:h2:~/jpashop (ìµœì†Œ í•œë²ˆ)

~/jpashop.mv.db íŒŒì¼ ìƒì„± í™•ì¸

ğŸ•”í›„ ë¶€í„°ëŠ” jdbc:h2:tcp://localhost/~/jpashop ğŸ•”ë ‡ê²Œ ì ‘ì†

**ì£¼ì˜**: H2 ë°ğŸ•”í„°ë² ğŸ•”ìŠ¤ì˜ MVCC ì˜µì…˜ì€ H2 1.4.198 ë²„ì „ë¶€í„° ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤. **ìµœì‹  ë²„ì „ì—ì„œëŠ” MVCC ì˜µì…˜
ì„ ì‚¬ìš©í•˜ë©´ ì˜¤ë¥˜ê°€ ë°œìƒ**í•©ë‹ˆë‹¤. ì˜ìƒì—ì„œ ë‚˜ì˜¤ëŠ” MVCC ì˜µì…˜ì€ ì œê±°í•´ì£¼ì„¸ìš”.

JPAì™€ DB ì„¤ì •, ë™ì‘í™•ì¸


main/resources/application.yml

```ya

spring:
datasource:

url: jdbc:h2:tcp://localhost/~/jpashop
username: sa

password:

driver-class-name: org.h2.Driver

jpa:

hibernate:

ddl-auto: create
properties:

hibernate:

#        show_sql: true
format_sql: true

logging.level:
org.hibernate.SQL: debug

#  org.hibernate.type: trace #ìŠ¤í”„ë§  ë¶€íŠ¸  2.x, hibernate5

#  org.hibernate.orm.jdbc.bind: trace #ìŠ¤í”„ë§  ë¶€íŠ¸  3.x, hibernate6

```

spring.jpa.hibernate.ddl-auto: create

ğŸ•” ì˜µì…˜ì€ ì• í”Œë¦¬ì¼€ğŸ•”ì…˜ ì‹¤í–‰ ì‹œì ì— í…ŒğŸ•”ë¸”ì„ drop í•˜ê³ , ë‹¤ì‹œ ìƒì„±í•œë‹¤.

ì°¸ê³ : ëª¨ë“  ë¡œê·¸ ì¶œë ¥ì€ ê°€ê¸‰ì  ë¡œê±°ë¥¼ í†µí•´ ë‚¨ê²¨ì•¼ í•œë‹¤.

show_sql : ì˜µì…˜ì€ System.out ì— í•˜ğŸ•”ë²„ë„¤ğŸ•”íŠ¸ ì‹¤í–‰ SQLì„ ë‚¨ê¸´ë‹¤.

org.hibernate.SQL : ì˜µì…˜ì€ loggerë¥¼ í†µí•´ í•˜ğŸ•”ë²„ë„¤ğŸ•”íŠ¸ ì‹¤í–‰ SQLì„ ë‚¨ê¸´ë‹¤.

**ì£¼ì˜!**                               application.yml ê°™ì€ yml íŒŒì¼ì€ ë„ì–´ì“°ê¸°(ìŠ¤í˜ğŸ•”ìŠ¤) 2ì¹¸ìœ¼ë¡œ ê³„ì¸µì„ ë§Œë“­ë‹ˆë‹¤. ë”°ë¼ì„œ 
ë„ì–´ì“°ê¸°

2ì¹¸ì„ í•„ìˆ˜ë¡œ ì ì–´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´ì„œ ì•„ë˜ì˜ datasource ëŠ” spring: í•˜ìœ„ì— ìˆê³  ì•ì— ë„ì–´ì“°ê¸° 2ì¹¸ğŸ•” ìˆìœ¼ë¯€ë¡œ

spring.datasource ê°€ ë©ë‹ˆë‹¤. ë‹¤ìŒ ì½”ë“œì— ì£¼ì„ìœ¼ë¡œ ë„ì–´ì“°ê¸°ë¥¼ ì ì–´ë‘ì—ˆìŠµë‹ˆë‹¤.

**yml ë„ì–´ì“°ê¸° ì£¼ì˜**

```ya

spring: #ë„ì–´ì“°ê¸°  ì—†ìŒ

datasource: #ë„ì–´ì“°ê¸°  2ì¹¸

url: jdbc:h2:tcp://localhost/~/jpashop #4ì¹¸
username: sa

password:


driver-class-name: org.h2.Driver

jpa: #ë„ì–´ì“°ê¸°  2ì¹¸
hibernate: #ë„ì–´ì“°ê¸°  4ì¹¸

ddl-auto: create #ë„ì–´ì“°ê¸°  6ì¹¸
properties: #ë„ì–´ì“°ê¸°  4ì¹¸

hibernate: #ë„ì–´ì“°ê¸°  6ì¹¸

#        show_sql: true   #ë„ì–´ì“°ê¸°  8ì¹¸
format_sql: true  #ë„ì–´ì“°ê¸°  8ì¹¸

logging.level: #ë„ì–´ì“°ê¸°  ì—†ìŒ

org.hibernate.SQL: debug #ë„ì–´ì“°ê¸°  2ì¹¸
#  org.hibernate.type: trace #ë„ì–´ì“°ê¸°  2ì¹¸

```

ì‹¤ì œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•˜ê¸°

**íšŒì› ì—”í‹°í‹°**

```

@Entity

@Getter @Setter
public class Member {

@Id @GeneratedValue
private Long id;

private String username;

...

}

```

**íšŒì› ë¦¬í¬ì§€í† ë¦¬**

```

@Repository

public class MemberRepository {

@PersistenceContext
EntityManager em;

public Long save(Member member) {
em.persist(member);

return member.getId();

}


public Member find(Long id) {

return em.find(Member.class, id);

}

}

```

**í…ŒìŠ¤íŠ¸

```

import jpabook.jpashop.domain.Member;

import jpabook.jpashop.repository.MemberRepository;
import org.junit.Test;

import org.junit.runner.RunWith;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit4.SpringRunner;
import org.springframework.transaction.annotation.Transactional;

import javax.persistence.EntityManager;

@RunWith(SpringRunner.class)
@SpringBootTest

public class MemberRepositoryTest {

@Autowired MemberRepository memberRepository;
@Test

@Transactional
@Rollback(false)

public void testMember() {

Member member = new Member();
member.setUsername("memberA");

Long savedId = memberRepository.save(member);
Member findMember = memberRepository.find(savedId);

Assertions.assertThat(findMember.getId()).isEqualTo(member.getId());
Assertions.assertThat(findMember.getUsername()).isEqualTo(member.getUsername());


}

```

Assertions.assertThat(findMember).isEqualTo(member); //JPA ì—”í‹°í‹°  ë™ì¼ì„±  ë³´ì¥

}

**ì£¼ì˜!**                   @TestëŠ” JUnit4ë¥¼ ì‚¬ìš©í•˜ë©´ org.junit.Testë¥¼ ì‚¬ìš©í•˜ì…”ì•¼ í•©ë‹ˆë‹¤. ë§Œì•½ JUnit5 ë²„ì „ì„ ì‚¬ìš©í•˜ë©´ ê·¸ê²ƒì—


ë§ê²Œ ì‚¬ìš©í•˜ì‹œë©´ ë©ë‹ˆë‹¤.

Entity, Repository ë™ì‘ í™•ì¸

jar ë¹Œë“œí•´ì„œ ë™ì‘ í™•ì¸

ì˜¤ë¥˜: í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í–ˆëŠ”ë° ë‹¤ìŒê³¼ ê°™ğŸ•” í…ŒìŠ¤íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí•˜ëŠ” ê²½ìš°

No tests found for given includes: [jpabook.jpashop.MemberRepositoryTest]
(filter.includeTestsMatching)

í•´ê²°: ìŠ¤í”„ë§ ë¶€íŠ¸ 2.1.x ë²„ì „ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³ , 2.2.x ğŸ•”ìƒ ë²„ì „ì„ ì‚¬ìš©í•˜ë©´  Junit5ê°€ ì„¤ì¹˜ëœë‹¤. ğŸ•”ë•ŒëŠ”

build.gradle ë§ˆì§€ë§‰ì— ë‹¤ìŒ ë‚´ìš©ì„ ì¶”ê°€í•˜ë©´ í…ŒìŠ¤íŠ¸ë¥¼ ì¸ì‹í•  ìˆ˜ ìˆë‹¤. Junit5 ë¶€í„°ëŠ” build.gradle ì—
ë‹¤ìŒ ë‚´ìš©ì„ ì¶”ê°€í•´ì•¼ í…ŒìŠ¤íŠ¸ê°€ ì¸ì‹ëœë‹¤.

build.gradle ë§ˆì§€ë§‰ì— ì¶”ê°€

```grvy

test {

useJUnitPlatform()

}

```

ì°¸ê³ : ìŠ¤í”„ë§ ë¶€íŠ¸ë¥¼ í†µí•´ ë³µì¡í•œ ì„¤ì •ğŸ•” ë‹¤ ìë™í™” ë˜ì—ˆë‹¤.  persistence.xml ë„ ì—†ê³ ,
LocalContainerEntityManagerFactoryBean ë„ ì—†ë‹¤. ìŠ¤í”„ë§ ë¶€íŠ¸ë¥¼ í†µí•œ ì¶”ê°€ ì„¤ì •ì€ ìŠ¤í”„ë§ ë¶€íŠ¸ ë©”
ë‰´ì–¼ì„ ì°¸ê³ í•˜ê³ , ìŠ¤í”„ë§ ë¶€íŠ¸ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  ìˆœìˆ˜ ìŠ¤í”„ë§ê³¼ JPA ì„¤ì • ë°©ë²•ì€ ìë°” ORM í‘œì¤€ JPA í”„ë¡œê·¸ë˜
ë° ì±…ì„ ì°¸ê³ í•˜ì.

ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ë¡œê·¸ ë‚¨ê¸°ê¸°

ë¡œê·¸ì— ë‹¤ìŒì„ ì¶”ê°€í•˜ê¸°: SQL ì‹¤í–‰ íŒŒë¼ë¯¸í„°ë¥¼ ë¡œê·¸ë¡œ ë‚¨ê¸´ë‹¤.

**ì£¼ì˜! ìŠ¤í”„ë§ ë¶€íŠ¸ 3.xë¥¼ ì‚¬ìš©í•œë‹¤ë©´ ì˜ìƒ ë‚´ìš©ê³¼ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— ë‹¤ìŒ ë‚´ìš©ì„ ì°¸ê³ í•˜ì.**

ìŠ¤í”„ë§ ë¶€íŠ¸ 2.x, hibernate5

org.hibernate.type: trace

ìŠ¤í”„ë§ ë¶€íŠ¸ 3.x, hibernate6

org.hibernate.orm.jdbc.bind: trace

ì™¸ë¶€ ë¼ğŸ•”ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©

https://github.com/gavlyukovskiy/spring-boot-data-source-decorator


ìŠ¤í”„ë§ ë¶€íŠ¸ë¥¼ ì‚¬ìš©í•˜ë©´ ğŸ•” ë¼ğŸ•”ë¸ŒëŸ¬ë¦¬ë§Œ ì¶”ê°€í•˜ë©´ ëœë‹¤.

```

implementation 'com.github.gavlyukovskiy:p6spy-spring-boot-starter:1.5.6'

```

ì°¸ê³ : ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¥¼ ë¡œê·¸ë¡œ ë‚¨ê¸°ëŠ” ì™¸ë¶€ ë¼ğŸ•”ë¸ŒëŸ¬ë¦¬ëŠ” ì‹œìŠ¤í…œ ìì›ì„ ì‚¬ìš©í•˜ë¯€ë¡œ, ê°œë°œ ë‹¨ê³„ì—ì„œëŠ” í¸í•˜ê²Œ ì‚¬
ìš©í•´ë„ ëœë‹¤. í•˜ì§€ë§Œ ìš´ì˜ì‹œìŠ¤í…œì— ì ìš©í•˜ë ¤ë©´ ê¼­ ì„±ëŠ¥í…ŒìŠ¤íŠ¸ë¥¼ í•˜ê³  ì‚¬ìš©í•˜ëŠ” ê²ƒğŸ•” ì¢‹ë‹¤.

ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ë¡œê·¸ ë‚¨ê¸°ê¸° - ìŠ¤í”„ë§ ë¶€íŠ¸ 3.0

ìŠ¤í”„ë§ ë¶€íŠ¸ 3.0 ğŸ•”ìƒì„ ì‚¬ìš©í•˜ë©´ ë¼ğŸ•”ë¸ŒëŸ¬ë¦¬ ë²„ì „ì„ 1.9.0 ğŸ•”ìƒì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

```

implementation 'com.github.gavlyukovskiy:p6spy-spring-boot-starter:1.9.0'

```


2. ë„ë©”ì¸ ë¶„ì„ ì„¤ê³„

#1.ì¸ê°•/jpaí™œìš©í¸/í™œìš©í¸1/ê°•ì˜

/ìš”êµ¬ì‚¬í•­ ë¶„ì„

/ë„ë©”ì¸ ëª¨ë¸ê³¼ í…ŒğŸ•”ë¸” ì„¤ê³„

/ì—”í‹°í‹° í´ë˜ìŠ¤ ê°œë°œ

/ì—”í‹°í‹° ì„¤ê³„ì‹œ ì£¼ì˜ì 

ìš”êµ¬ì‚¬í•­ ë¶„ì„

**ì‹¤ì œ ë™ì‘í•˜ëŠ” í™”ë©´ì„ ë¨¼ì € í™•ì¸í•œë‹¤.**

**ê¸°ëŠ¥ ëª©ë¡**


íšŒì› ê¸°ëŠ¥

íšŒì› ë“±ë¡
íšŒì› ì¡°íšŒ

ìƒí’ˆ ê¸°ëŠ¥

ìƒí’ˆ ë“±ë¡
ìƒí’ˆ ìˆ˜ì •
ìƒí’ˆ ì¡°íšŒ

ì£¼ë¬¸ ê¸°ëŠ¥

ìƒí’ˆ ì£¼ë¬¸
ì£¼ë¬¸ ë‚´ì—­ ì¡°íšŒ
ì£¼ë¬¸ ì·¨ì†Œ

ê¸°íƒ€ ìš”êµ¬ì‚¬í•­

ìƒí’ˆì€ ì¬ê³  ê´€ë¦¬ê°€ í•„ìš”í•˜ë‹¤.

ìƒí’ˆì˜ ì¢…ë¥˜ëŠ” ë„ì„œ, ìŒë°˜, ì˜í™”ê°€ ìˆë‹¤.
ìƒí’ˆì„ ì¹´í…Œê³ ë¦¬ë¡œ êµ¬ë¶„í•  ìˆ˜ ìˆë‹¤.

ìƒí’ˆ ì£¼ë¬¸ì‹œ ë°°ì†¡ ì •ë³´ë¥¼ ì…ë ¥í•  ìˆ˜ ìˆë‹¤.

ë„ë©”ì¸ ëª¨ë¸ê³¼ í…Œì´ë¸” ì„¤ê³„

**íšŒì›, ì£¼ë¬¸, ìƒí’ˆì˜ ê´€ê³„:**                   íšŒì›ì€ ì—¬ëŸ¬ ìƒí’ˆì„ ì£¼ë¬¸í•  ìˆ˜ ìˆë‹¤. ê·¸ë¦¬ê³  í•œ ë²ˆ ì£¼ë¬¸í•  ë•Œ ì—¬ëŸ¬ ìƒí’ˆì„ ì„ íƒí•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ
ì£¼ë¬¸ê³¼ ìƒí’ˆì€ ë‹¤ëŒ€ë‹¤ ê´€ê³„ë‹¤. í•˜ì§€ë§Œ ğŸ•”ëŸ° ë‹¤ëŒ€ë‹¤ ê´€ê³„ëŠ” ê´€ê³„í˜• ë°ğŸ•”í„°ë² ğŸ•”ìŠ¤ëŠ” ë¬¼ë¡ ğŸ•”ê³  ì—”í‹°í‹°ì—ì„œë„ ê±°ì˜ ì‚¬ìš©í•˜
ì§€ ì•ŠëŠ”ë‹¤. ë”°ë¼ì„œ ê·¸ë¦¼ì²˜ëŸ¼ ì£¼ë¬¸ìƒí’ˆğŸ•”ë¼ëŠ” ì—”í‹°í‹°ë¥¼ ì¶”ê°€í•´ì„œ ë‹¤ëŒ€ë‹¤ ê´€ê³„ë¥¼ ì¼ëŒ€ë‹¤, ë‹¤ëŒ€ì¼ ê´€ê³„ë¡œ í’€ì–´ëƒˆë‹¤.

**ìƒí’ˆ ë¶„ë¥˜:**                   ìƒí’ˆì€ ë„ì„œ, ìŒë°˜, ì˜í™”ë¡œ êµ¬ë¶„ë˜ëŠ”ë° ìƒí’ˆğŸ•”ë¼ëŠ” ê³µí†µ ì†ì„±ì„ ì‚¬ìš©í•˜ë¯€ë¡œ ìƒì† êµ¬ì¡°ë¡œ í‘œí˜„í–ˆë‹¤.


íšŒì› ì—”í‹°í‹° ë¶„ì„

**íšŒì›(Member):**                   ğŸ•”ë¦„ê³¼ ì„ë² ë””ë“œ íƒ€ì…ì¸ ì£¼ì†Œ( Address ), ê·¸ë¦¬ê³  ì£¼ë¬¸( orders ) ë¦¬ìŠ¤íŠ¸ë¥¼ ê°€ì§„ë‹¤.

**ì£¼ë¬¸(Order):**                   í•œ ë²ˆ ì£¼ë¬¸ì‹œ ì—¬ëŸ¬ ìƒí’ˆì„ ì£¼ë¬¸í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì£¼ë¬¸ê³¼ ì£¼ë¬¸ìƒí’ˆ( OrderItem )ì€ ì¼ëŒ€ë‹¤ ê´€ê³„ë‹¤. ì£¼ë¬¸ì€
ìƒí’ˆì„ ì£¼ë¬¸í•œ íšŒì›ê³¼ ë°°ì†¡ ì •ë³´, ì£¼ë¬¸ ë‚ ì§œ, ì£¼ë¬¸ ìƒíƒœ( status )ë¥¼ ê°€ì§€ê³  ìˆë‹¤. ì£¼ë¬¸ ìƒíƒœëŠ” ì—´ê±°í˜•ì„ ì‚¬ìš©í–ˆëŠ”ë° ì£¼
ë¬¸( ORDER ), ì·¨ì†Œ( CANCEL )ì„ í‘œí˜„í•  ìˆ˜ ìˆë‹¤.

**ì£¼ë¬¸ìƒí’ˆ(OrderItem):**                   ì£¼ë¬¸í•œ ìƒí’ˆ ì •ë³´ì™€ ì£¼ë¬¸ ê¸ˆì•¡( orderPrice ), ì£¼ë¬¸ ìˆ˜ëŸ‰( count ) ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆë‹¤. (ë³´
í†µ OrderLine ,  LineItem ìœ¼ë¡œ ë§ğŸ•” í‘œí˜„í•œë‹¤.)

**ìƒí’ˆ(Item)**: ğŸ•”ë¦„, ê°€ê²©, ì¬ê³ ìˆ˜ëŸ‰( stockQuantity )ì„ ê°€ì§€ê³  ìˆë‹¤. ìƒí’ˆì„ ì£¼ë¬¸í•˜ë©´ ì¬ê³ ìˆ˜ëŸ‰ğŸ•” ì¤„ì–´ë“ ë‹¤. ìƒí’ˆì˜
ì¢…ë¥˜ë¡œëŠ” ë„ì„œ, ìŒë°˜, ì˜í™”ê°€ ìˆëŠ”ë° ê°ê°ì€ ì‚¬ìš©í•˜ëŠ” ì†ì„±ğŸ•” ì¡°ê¸ˆì”© ë‹¤ë¥´ë‹¤.

**ë°°ì†¡(Delivery)**: ì£¼ë¬¸ì‹œ í•˜ë‚˜ì˜ ë°°ì†¡ ì •ë³´ë¥¼ ìƒì„±í•œë‹¤. ì£¼ë¬¸ê³¼ ë°°ì†¡ì€ ì¼ëŒ€ì¼ ê´€ê³„ë‹¤.

**ì¹´í…Œê³ ë¦¬(Category):**                   ìƒí’ˆê³¼ ë‹¤ëŒ€ë‹¤ ê´€ê³„ë¥¼ ë§ºëŠ”ë‹¤.  parent ,  child ë¡œ ë¶€ëª¨, ìì‹ ì¹´í…Œê³ ë¦¬ë¥¼ ì—°ê²°í•œë‹¤.

**ì£¼ì†Œ(Address)**: ê°’ íƒ€ì…(ì„ë² ë””ë“œ íƒ€ì…)ğŸ•”ë‹¤. íšŒì›ê³¼ ë°°ì†¡(Delivery)ì—ì„œ ì‚¬ìš©í•œë‹¤.


ì°¸ê³ : íšŒì› ì—”í‹°í‹° ë¶„ì„ ê·¸ë¦¼ì—ì„œ Orderì™€ Deliveryê°€ ë‹¨ë°©í–¥ ê´€ê³„ë¡œ ì˜ëª» ê·¸ë ¤ì ¸ ìˆë‹¤. ì–‘ë°©í–¥ ê´€ê³„ê°€ ë§ë‹¤.

ì°¸ê³ : íšŒì›ğŸ•” ì£¼ë¬¸ì„ í•˜ê¸° ë•Œë¬¸ì—, íšŒì›ğŸ•” ì£¼ë¬¸ë¦¬ìŠ¤íŠ¸ë¥¼ ê°€ì§€ëŠ” ê²ƒì€ ì–¼í• ë³´ë©´ ì˜ ì„¤ê³„í•œ ê²ƒ ê°™ì§€ë§Œ, ê°ì²´ ì„¸ìƒì€
ì‹¤ì œ ì„¸ê³„ì™€ëŠ” ë‹¤ë¥´ë‹¤. ì‹¤ë¬´ì—ì„œëŠ” íšŒì›ğŸ•” ì£¼ë¬¸ì„ ì°¸ì¡°í•˜ì§€ ì•Šê³ , ì£¼ë¬¸ğŸ•” íšŒì›ì„ ì°¸ì¡°í•˜ëŠ” ê²ƒìœ¼ë¡œ ì¶©ë¶„í•˜ë‹¤. ì—¬ê¸°
ì„œëŠ” ì¼ëŒ€ë‹¤, ë‹¤ëŒ€ì¼ì˜ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ë¥¼ ì„¤ëª…í•˜ê¸° ìœ„í•´ì„œ ì¶”ê°€í–ˆë‹¤.

íšŒì› í…Œì´ë¸” ë¶„ì„

**MEMBER**: íšŒì› ì—”í‹°í‹°ì˜  Address ì„ë² ë””ë“œ íƒ€ì… ì •ë³´ê°€ íšŒì› í…ŒğŸ•”ë¸”ì— ê·¸ëŒ€ë¡œ ë“¤ì–´ê°”ë‹¤. ğŸ•”ê²ƒì€ DELIVERY í…Œ

ğŸ•”ë¸”ë„ ë§ˆì°¬ê°€ì§€ë‹¤.

**ITEM**: ì•¨ë²”, ë„ì„œ, ì˜í™” íƒ€ì…ì„ í†µí•©í•´ì„œ í•˜ë‚˜ì˜ í…ŒğŸ•”ë¸”ë¡œ ë§Œë“¤ì—ˆë‹¤.  DTYPE ì»¬ëŸ¼ìœ¼ë¡œ íƒ€ì…ì„ êµ¬ë¶„í•œë‹¤.


ì°¸ê³ : í…ŒğŸ•”ë¸”ëª…ğŸ•” ORDER ê°€ ì•„ë‹ˆë¼ ORDERS ì¸ ê²ƒì€ ë°ğŸ•”í„°ë² ğŸ•”ìŠ¤ê°€ order by ë•Œë¬¸ì— ì˜ˆì•½ì–´ë¡œ ì¡ê³  ìˆëŠ”
ê²½ìš°ê°€ ë§ë‹¤. ê·¸ë˜ì„œ ê´€ë¡€ìƒ ORDERS ë¥¼ ë§ğŸ•” ì‚¬ìš©í•œë‹¤.

**ì°¸ê³ : ì‹¤ì œ ì½”ë“œì—ì„œëŠ” DBì— ì†Œë¬¸ì + _(ì–¸ë”ìŠ¤ì½”ì–´) ìŠ¤íƒ€ì¼ì„ ì‚¬ìš©í•˜ê² ë‹¤.**

ë°ğŸ•”í„°ë² ğŸ•”ìŠ¤ í…ŒğŸ•”ë¸”ëª…, ì»¬ëŸ¼ëª…ì— ëŒ€í•œ ê´€ë¡€ëŠ” íšŒì‚¬ë§ˆë‹¤ ë‹¤ë¥´ë‹¤. ë³´í†µì€ ëŒ€ë¬¸ì + _(ì–¸ë”ìŠ¤ì½”ì–´)ë‚˜ ì†Œë¬¸ì + _(ì–¸
ë”ìŠ¤ì½”ì–´) ë°©ì‹ ì¤‘ì— í•˜ë‚˜ë¥¼ ì§€ì •í•´ì„œ ì¼ê´€ì„± ìˆê²Œ ì‚¬ìš©í•œë‹¤. ê°•ì˜ì—ì„œ ì„¤ëª…í•  ë•ŒëŠ” ê°ì²´ì™€ ì°¨ğŸ•”ë¥¼ ë‚˜íƒ€ë‚´ê¸° ìœ„í•´
ë°ğŸ•”í„°ë² ğŸ•”ìŠ¤ í…ŒğŸ•”ë¸”, ì»¬ëŸ¼ëª…ì€ ëŒ€ë¬¸ìë¥¼ ì‚¬ìš©í–ˆì§€ë§Œ, **ì‹¤ì œ ì½”ë“œì—ì„œëŠ” ì†Œë¬¸ì + _(ì–¸ë”ìŠ¤ì½”ì–´) ìŠ¤íƒ€ì¼ì„ ì‚¬ìš©í•˜
ê² ë‹¤.**

ì—°ê´€ê´€ê³„ ë§¤í•‘ ë¶„ì„

**íšŒì›ê³¼ ì£¼ë¬¸:**                   ì¼ëŒ€ë‹¤ , ë‹¤ëŒ€ì¼ì˜ ì–‘ë°©í–¥ ê´€ê³„ë‹¤. ë”°ë¼ì„œ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì„ ì •í•´ì•¼ í•˜ëŠ”ë°, ì™¸ë˜ í‚¤ê°€ ìˆëŠ” ì£¼ë¬¸ì„ ì—°ê´€
ê´€ê³„ì˜ ì£¼ì¸ìœ¼ë¡œ ì •í•˜ëŠ” ê²ƒğŸ•” ì¢‹ë‹¤. ê·¸ëŸ¬ë¯€ë¡œ Order.member ë¥¼ ORDERS.MEMBER_ID ì™¸ë˜ í‚¤ì™€ ë§¤í•‘í•œë‹¤.

**ì£¼ë¬¸ìƒí’ˆê³¼ ì£¼ë¬¸:**                   ë‹¤ëŒ€ì¼ ì–‘ë°©í–¥ ê´€ê³„ë‹¤. ì™¸ë˜ í‚¤ê°€ ì£¼ë¬¸ìƒí’ˆì— ìˆìœ¼ë¯€ë¡œ ì£¼ë¬¸ìƒí’ˆğŸ•” ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ğŸ•”ë‹¤. ê·¸ëŸ¬ë¯€ë¡œ

OrderItem.order ë¥¼ ORDER_ITEM.ORDER_ID ì™¸ë˜ í‚¤ì™€ ë§¤í•‘í•œë‹¤.

**ì£¼ë¬¸ìƒí’ˆê³¼ ìƒí’ˆ:**                   ë‹¤ëŒ€ì¼ ë‹¨ë°©í–¥ ê´€ê³„ë‹¤.  OrderItem.item ì„ ORDER_ITEM.ITEM_ID ì™¸ë˜ í‚¤ì™€ ë§¤í•‘í•œë‹¤.

**ì£¼ë¬¸ê³¼ ë°°ì†¡:**                   ì¼ëŒ€ì¼ ì–‘ë°©í–¥ ê´€ê³„ë‹¤.  Order.delivery ë¥¼ ORDERS.DELIVERY_ID ì™¸ë˜ í‚¤ì™€ ë§¤í•‘í•œë‹¤.

**ì¹´í…Œê³ ë¦¬ì™€ ìƒí’ˆ:**                               @ManyToMany ë¥¼ ì‚¬ìš©í•´ì„œ ë§¤í•‘í•œë‹¤.(ì‹¤ë¬´ì—ì„œ @ManyToManyëŠ” ì‚¬ìš©í•˜ì§€ ë§ì. 
ì—¬ê¸°ì„œëŠ” ë‹¤ëŒ€
ë‹¤ ê´€ê³„ë¥¼ ì˜ˆì œë¡œ ë³´ì—¬ì£¼ê¸° ìœ„í•´ ì¶”ê°€í–ˆì„ ë¿ğŸ•”ë‹¤)

**ì°¸ê³ : ì™¸ë˜ í‚¤ê°€ ìˆëŠ” ê³³ì„ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ìœ¼ë¡œ ì •í•´ë¼.**

ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì€ ë‹¨ìˆœíˆ ì™¸ë˜ í‚¤ë¥¼ ëˆ„ê°€ ê´€ë¦¬í•˜ëƒì˜ ë¬¸ì œğŸ•”ì§€ ë¹„ì¦ˆë‹ˆìŠ¤ìƒ ìš°ìœ„ì— ìˆë‹¤ê³  ì£¼ì¸ìœ¼ë¡œ ì •í•˜ë©´ ì•ˆëœ
ë‹¤.. ì˜ˆë¥¼ ë“¤ì–´ì„œ ìë™ì°¨ì™€ ë°”í€´ê°€ ìˆìœ¼ë©´, ì¼ëŒ€ë‹¤ ê´€ê³„ì—ì„œ í•­ìƒ ë‹¤ìª½ì— ì™¸ë˜ í‚¤ê°€ ìˆìœ¼ë¯€ë¡œ ì™¸ë˜ í‚¤ê°€ ìˆëŠ” ë°”í€´
ë¥¼ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ìœ¼ë¡œ ì •í•˜ë©´ ëœë‹¤. ë¬¼ë¡  ìë™ì°¨ë¥¼ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ìœ¼ë¡œ ì •í•˜ëŠ” ê²ƒğŸ•” ë¶ˆê°€ëŠ¥ í•œ ê²ƒì€ ì•„ë‹ˆì§€ë§Œ,
ìë™ì°¨ë¥¼ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ìœ¼ë¡œ ì •í•˜ë©´ ìë™ì°¨ê°€ ê´€ë¦¬í•˜ì§€ ì•ŠëŠ” ë°”í€´ í…ŒğŸ•”ë¸”ì˜ ì™¸ë˜ í‚¤ ê°’ğŸ•” ì—…ë°ğŸ•”íŠ¸ ë˜ë¯€ë¡œ ê´€ë¦¬
ì™€ ìœ ì§€ë³´ìˆ˜ê°€ ì–´ë µê³ , ì¶”ê°€ì ìœ¼ë¡œ ë³„ë„ì˜ ì—…ë°ğŸ•”íŠ¸ ì¿¼ë¦¬ê°€ ë°œìƒí•˜ëŠ” ì„±ëŠ¥ ë¬¸ì œë„ ìˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ JPA ê¸°ë³¸
í¸ì„ ì°¸ê³ í•˜ì.

ì—”í‹°í‹° í´ë˜ìŠ¤ ê°œë°œ

ì˜ˆì œì—ì„œëŠ” ì„¤ëª…ì„ ì‰½ê²Œí•˜ê¸° ìœ„í•´ ì—”í‹°í‹° í´ë˜ìŠ¤ì— Getter, Setterë¥¼ ëª¨ë‘ ì—´ê³ , ìµœëŒ€í•œ ë‹¨ìˆœí•˜ê²Œ ì„¤ê³„
ì‹¤ë¬´ì—ì„œëŠ” ê°€ê¸‰ì  GetterëŠ” ì—´ì–´ë‘ê³ , SetterëŠ” ê¼­ í•„ìš”í•œ ê²½ìš°ì—ë§Œ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ì¶”ì²œ


ì°¸ê³ : ğŸ•”ë¡ ì ìœ¼ë¡œ Getter, Setter ëª¨ë‘ ì œê³µí•˜ì§€ ì•Šê³ , ê¼­ í•„ìš”í•œ ë³„ë„ì˜ ë©”ì„œë“œë¥¼ ì œê³µí•˜ëŠ”ê²Œ ê°€ì¥ ğŸ•”ìƒì ğŸ•”ë‹¤.
í•˜ì§€ë§Œ ì‹¤ë¬´ì—ì„œ ì—”í‹°í‹°ì˜ ë°ğŸ•”í„°ëŠ” ì¡°íšŒí•  ì¼ğŸ•” ë„ˆë¬´ ë§ìœ¼ë¯€ë¡œ, Getterì˜ ê²½ìš° ëª¨ë‘ ì—´ì–´ë‘ëŠ” ê²ƒğŸ•” í¸ë¦¬í•˜ë‹¤.
GetterëŠ” ì•„ë¬´ë¦¬ í˜¸ì¶œí•´ë„ í˜¸ì¶œ í•˜ëŠ” ê²ƒ ë§Œìœ¼ë¡œ ì–´ë–¤ ì¼ğŸ•” ë°œìƒí•˜ì§€ëŠ” ì•ŠëŠ”ë‹¤. í•˜ì§€ë§Œ SetterëŠ” ë¬¸ì œê°€ ë‹¤ë¥´ë‹¤.
Setterë¥¼ í˜¸ì¶œí•˜ë©´ ë°ğŸ•”í„°ê°€ ë³€í•œë‹¤. Setterë¥¼ ë§‰ ì—´ì–´ë‘ë©´ ê°€ê¹Œìš´ ë¯¸ë˜ì— ì—”í‹°í‹°ê°€ ë„ëŒ€ì²´ ì™œ ë³€ê²½ë˜ëŠ”ì§€ ì¶”ì 
í•˜ê¸° ì ì  í˜ë“¤ì–´ì§„ë‹¤. ê·¸ë˜ì„œ ì—”í‹°í‹°ë¥¼ ë³€ê²½í•  ë•ŒëŠ” Setter ëŒ€ì‹ ì— ë³€ê²½ ì§€ì ğŸ•” ëª…í™•í•˜ë„ë¡ ë³€ê²½ì„ ìœ„í•œ ë¹„ì¦ˆë‹ˆ
ìŠ¤ ë©”ì„œë“œë¥¼ ë³„ë„ë¡œ ì œê³µí•´ì•¼ í•œë‹¤.

**íšŒì› ì—”í‹°í‹°**

```

package jpabook.jpashop.domain;

import javax.persistence.*;
import java.util.ArrayList;
import java.util.List;

@Entity

@Getter @Setter
public class Member {

@Id @GeneratedValue
@Column(name = "member_id")
private Long id;

private String name;

@Embedded

private Address address;

@OneToMany(mappedBy = "member")

private List<Order> orders = new ArrayList<>();

}

```

ì°¸ê³ : ì—”í‹°í‹°ì˜ ì‹ë³„ìëŠ” id ë¥¼ ì‚¬ìš©í•˜ê³  PK ì»¬ëŸ¼ëª…ì€ member_id ë¥¼ ì‚¬ìš©í–ˆë‹¤. ì—”í‹°í‹°ëŠ” íƒ€ì…(ì—¬ê¸°ì„œëŠ”

Member )ğŸ•” ìˆìœ¼ë¯€ë¡œ id í•„ë“œë§Œìœ¼ë¡œ ì‰½ê²Œ êµ¬ë¶„í•  ìˆ˜ ìˆë‹¤. í…ŒğŸ•”ë¸”ì€ íƒ€ì…ğŸ•” ì—†ìœ¼ë¯€ë¡œ êµ¬ë¶„ğŸ•” ì–´ë µë‹¤. ê·¸ë¦¬ê³  í…Œ

ğŸ•”ë¸”ì€ ê´€ë¡€ìƒ í…ŒğŸ•”ë¸”ëª…  + id ë¥¼ ë§ğŸ•” ì‚¬ìš©í•œë‹¤. ì°¸ê³ ë¡œ ê°ì²´ì—ì„œ id ëŒ€ì‹ ì— memberId ë¥¼ ì‚¬ìš©í•´ë„ ëœë‹¤. ì¤‘
ìš”í•œ ê²ƒì€ ì¼ê´€ì„±ğŸ•”ë‹¤.

**ì£¼ë¬¸ ì—”í‹°í‹°**

```

package jpabook.jpashop.domain;


import lombok.Getter;
import lombok.Setter;

import javax.persistence.*;
import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.List;

@Entity

@Table(name = "orders")
@Getter @Setter

public class Order {

@Id @GeneratedValue
@Column(name = "order_id")
private Long id;

@ManyToOne(fetch = FetchType.LAZY)
@JoinColumn(name = "member_id")
private      Member member; //ì£¼ë¬¸  íšŒì›

@OneToMany(mappedBy = "order", cascade = CascadeType.ALL)
private List<OrderItem> orderItems = new ArrayList<>();

@OneToOne(cascade = CascadeType.ALL, fetch = FetchType.LAZY)
@JoinColumn(name = "delivery_id")

private Delivery delivery; //ë°°ì†¡ì •ë³´

private LocalDateTime orderDate; //ì£¼ë¬¸ì‹œê°„
@Enumerated(EnumType.STRING)

private OrderStatus status; //ì£¼ë¬¸ìƒíƒœ  [ORDER, CANCEL]

//==ì—°ê´€ê´€ê³„  ë©”ì„œë“œ==//

public void setMember(Member member) {
this.member = member;
member.getOrders().add(this);

}

public void addOrderItem(OrderItem orderItem) {
orderItems.add(orderItem);
orderItem.setOrder(this);


}

public void setDelivery(Delivery delivery) {
this.delivery = delivery;
delivery.setOrder(this);

}

}

```

**ì£¼ë¬¸ìƒíƒœ**

```

package jpabook.jpashop.domain;

public enum OrderStatus {
ORDER, CANCEL

}

```

**ì£¼ë¬¸ìƒí’ˆ ì—”í‹°í‹°**

```

package jpabook.jpashop.domain;

import lombok.Getter;
import lombok.Setter;

import jpabook.jpashop.domain.item.Item;
import javax.persistence.*;

@Entity

@Table(name = "order_item")
@Getter @Setter

public class OrderItem {

@Id @GeneratedValue
@Column(name = "order_item_id")
private Long id;

@ManyToOne(fetch = FetchType.LAZY)
@JoinColumn(name = "item_id")
private          Item item;      //ì£¼ë¬¸  ìƒí’ˆ

@ManyToOne(fetch = FetchType.LAZY)
@JoinColumn(name = "order_id")
private        Order order;    //ì£¼ë¬¸


private int orderPrice; //ì£¼ë¬¸  ê°€ê²©

private int count;      //ì£¼ë¬¸  ìˆ˜ëŸ‰

}

```

**ìƒí’ˆ ì—”í‹°í‹°**

```

package jpabook.jpashop.domain.item;

import lombok.Getter;
import lombok.Setter;

import jpabook.jpashop.domain.Category;
import javax.persistence.*;

import java.util.ArrayList;
import java.util.List;

@Entity

@Inheritance(strategy = InheritanceType.SINGLE_TABLE)
@DiscriminatorColumn(name = "dtype")

@Getter @Setter

public abstract class Item {

@Id @GeneratedValue
@Column(name = "item_id")
private Long id;

private String name;
private int price;

private int stockQuantity;

@ManyToMany(mappedBy = "items")

private List<Category> categories = new ArrayList<Category>();

}

```

**ìƒí’ˆ - ë„ì„œ ì—”í‹°í‹°**

```

package jpabook.jpashop.domain.item;

import lombok.Getter;
import lombok.Setter;


import javax.persistence.DiscriminatorValue;
import javax.persistence.Entity;

@Entity
@DiscriminatorValue("B")
@Getter                   @Setter

public class Book extends Item {

private String author;
private String isbn;

}

```

**ìƒí’ˆ - ìŒë°˜ ì—”í‹°í‹°**

```

package jpabook.jpashop.domain.item;

import lombok.Getter;
import lombok.Setter;

import javax.persistence.DiscriminatorValue;
import javax.persistence.Entity;

@Entity
@DiscriminatorValue("A")
@Getter                   @Setter

public class Album extends Item {

private String artist;
private String etc;

}

```

**ìƒí’ˆ - ì˜í™” ì—”í‹°í‹°**

```

package jpabook.jpashop.domain.item;

import lombok.Getter;
import lombok.Setter;

import javax.persistence.DiscriminatorValue;
import javax.persistence.Entity;

@Entity


@DiscriminatorValue("M")
@Getter @Setter

public class Movie extends Item {

private String director;
private String actor;

}

```

**ë°°ì†¡ ì—”í‹°í‹°**

```

package jpabook.jpashop.domain;

import lombok.Getter;
import lombok.Setter;

import javax.persistence.*;

@Entity

@Getter @Setter

public class Delivery {

@Id @GeneratedValue
@Column(name = "delivery_id")
private Long id;

@OneToOne(mappedBy = "delivery", fetch = FetchType.LAZY)
private Order order;

@Embedded

private Address address;

@Enumerated(EnumType.STRING)

private DeliveryStatus status; //ENUM [READY(ì¤€ë¹„), COMP(ë°°ì†¡)]

}

```

**ë°°ì†¡ ìƒíƒœ**

```

package jpabook.jpashop.domain;

public enum DeliveryStatus {
READY, COMP

}

```


**ì¹´í…Œê³ ë¦¬ ì—”í‹°í‹°**

```

package jpabook.jpashop.domain;

import lombok.Getter;
import lombok.Setter;

import jpabook.jpashop.domain.item.Item;

import javax.persistence.*;
import java.util.ArrayList;
import java.util.List;

@Entity

@Getter @Setter

public class Category {

@Id @GeneratedValue
@Column(name = "category_id")
private Long id;

private String name;

@ManyToMany

@JoinTable(name = "category_item",

joinColumns = @JoinColumn(name = "category_id"),
inverseJoinColumns = @JoinColumn(name = "item_id"))

private List<Item> items = new ArrayList<>();

@ManyToOne(fetch = FetchType.LAZY)
@JoinColumn(name = "parent_id")
private    Category parent;

@OneToMany(mappedBy = "parent")

private List<Category> child = new ArrayList<>();

//==ì—°ê´€ê´€ê³„  ë©”ì„œë“œ==//

public void addChildCategory(Category child) {
this.child.add(child);
child.setParent(this);

}

}

```


ì°¸ê³ : ì‹¤ë¬´ì—ì„œëŠ” @ManyToMany ë¥¼ ì‚¬ìš©í•˜ì§€ ë§ì

@ManyToMany ëŠ” í¸ë¦¬í•œ ê²ƒ ê°™ì§€ë§Œ, ì¤‘ê°„ í…ŒğŸ•”ë¸”( CATEGORY_ITEM )ì— ì»¬ëŸ¼ì„ ì¶”ê°€í•  ìˆ˜ ì—†ê³ , ì„¸ë°€í•˜ê²Œ ì¿¼ë¦¬
ë¥¼ ì‹¤í–‰í•˜ê¸° ì–´ë µê¸° ë•Œë¬¸ì— ì‹¤ë¬´ì—ì„œ ì‚¬ìš©í•˜ê¸°ì—ëŠ” í•œê³„ê°€ ìˆë‹¤. ì¤‘ê°„ ì—”í‹°í‹°( CategoryItem ë¥¼ ë§Œë“¤ê³ 
@ManyToOne ,  @OneToMany ë¡œ ë§¤í•‘í•´ì„œ ì‚¬ìš©í•˜ì. ì •ë¦¬í•˜ë©´ ë‹¤ëŒ€ë‹¤ ë§¤í•‘ì„ ì¼ëŒ€ë‹¤, ë‹¤ëŒ€ì¼ ë§¤í•‘ìœ¼ë¡œ í’€ì–´ë‚´
ì„œ    ì‚¬ìš©í•˜ì.

**ì£¼ì†Œ ê°’ íƒ€ì…**

```

package jpabook.jpashop.domain;

import lombok.Getter;
import lombok.Setter;

import javax.persistence.Embeddable;

@Embeddable
@Getter

public class Address {

private String city;
private String street;
private String zipcode;

protected Address() {

}

public Address(String city, String street, String zipcode) {
this.city = city;

this.street = street;
this.zipcode = zipcode;

}

}

```

ì°¸ê³ : ê°’ íƒ€ì…ì€ ë³€ê²½ ë¶ˆê°€ëŠ¥í•˜ê²Œ ì„¤ê³„í•´ì•¼ í•œë‹¤.

@Setter ë¥¼ ì œê±°í•˜ê³ , ìƒì„±ìì—ì„œ ê°’ì„ ëª¨ë‘ ì´ˆê¸°í™”í•´ì„œ ë³€ê²½ ë¶ˆê°€ëŠ¥í•œ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì. JPA ìŠ¤í™ìƒ ì—”í‹°í‹°ë‚˜
ì„ë² ë””ë“œ íƒ€ì…( @Embeddable )ì€ ìë°” ê¸°ë³¸ ìƒì„±ì(default constructor)ë¥¼ public ë˜ëŠ” protected ë¡œ
ì„¤ì •í•´ì•¼ í•œë‹¤.  public ìœ¼ë¡œ ë‘ëŠ” ê²ƒ ë³´ë‹¤ëŠ” protected ë¡œ ì„¤ì •í•˜ëŠ” ê²ƒğŸ•” ê·¸ë‚˜ë§ˆ ë” ì•ˆì „í•˜ë‹¤.

JPAê°€ ğŸ•”ëŸ° ì œì•½ì„ ë‘ëŠ” ğŸ•”ìœ ëŠ” JPA êµ¬í˜„ ë¼ğŸ•”ë¸ŒëŸ¬ë¦¬ê°€ ê°ì²´ë¥¼ ìƒì„±í•  ë•Œ ë¦¬í”Œë™ì…˜ ê°™ì€ ê¸°ìˆ ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë„
ë¡ ì§€ì›í•´ì•¼ í•˜ê¸° ë•Œë¬¸ğŸ•”ë‹¤.


ì—”í‹°í‹° ì„¤ê³„ì‹œ ì£¼ì˜ì 

ì—”í‹°í‹°ì—ëŠ” ê°€ê¸‰ì  Setterë¥¼ ì‚¬ìš©í•˜ì§€ ë§ì

Setterê°€ ëª¨ë‘ ì—´ë ¤ìˆë‹¤. ë³€ê²½ í¬ì¸íŠ¸ê°€ ë„ˆë¬´ ë§ì•„ì„œ, ìœ ì§€ë³´ìˆ˜ê°€ ì–´ë µë‹¤. ë‚˜ì¤‘ì— ë¦¬í™í† ë§ìœ¼ë¡œ Setter ì œê±°

ëª¨ë“  ì—°ê´€ê´€ê³„ëŠ” ì§€ì—°ë¡œë”©ìœ¼ë¡œ ì„¤ì •!

ì¦‰ì‹œë¡œë”©( EAGER )ì€ ì˜ˆì¸¡ğŸ•” ì–´ë µê³ , ì–´ë–¤ SQLğŸ•” ì‹¤í–‰ë ì§€ ì¶”ì í•˜ê¸° ì–´ë µë‹¤. íŠ¹íˆ JPQLì„ ì‹¤í–‰í•  ë•Œ N+1 ë¬¸ì œ
ê°€ ìì£¼ ë°œìƒí•œë‹¤.

ì‹¤ë¬´ì—ì„œ ëª¨ë“  ì—°ê´€ê´€ê³„ëŠ” ì§€ì—°ë¡œë”©( LAZY )ìœ¼ë¡œ ì„¤ì •í•´ì•¼ í•œë‹¤.

ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ í•¨ê»˜ DBì—ì„œ ì¡°íšŒí•´ì•¼ í•˜ë©´, fetch join ë˜ëŠ” ì—”í‹°í‹° ê·¸ë˜í”„ ê¸°ëŠ¥ì„ ì‚¬ìš©í•œë‹¤.
@XToOne(OneToOne, ManyToOne) ê´€ê³„ëŠ” ê¸°ë³¸ğŸ•” ì¦‰ì‹œë¡œë”©ğŸ•”ë¯€ë¡œ ì§ì ‘ ì§€ì—°ë¡œë”©ìœ¼ë¡œ ì„¤ì •í•´ì•¼ í•œë‹¤.

ì»¬ë ‰ì…˜ì€ í•„ë“œì—ì„œ ì´ˆê¸°í™” í•˜ì.

ì»¬ë ‰ì…˜ì€ í•„ë“œì—ì„œ ë°”ë¡œ ì´ˆê¸°í™” í•˜ëŠ” ê²ƒğŸ•” ì•ˆì „í•˜ë‹¤.

null ë¬¸ì œì—ì„œ ì•ˆì „í•˜ë‹¤.

í•˜ğŸ•”ë²„ë„¤ğŸ•”íŠ¸ëŠ” ì—”í‹°í‹°ë¥¼ ì˜ì†í™” í•  ë•Œ, ì»¬ë™ì…˜ì„ ê°ì‹¸ì„œ í•˜ğŸ•”ë²„ë„¤ğŸ•”íŠ¸ê°€ ì œê³µí•˜ëŠ” ë‚´ì¥ ì»¬ë ‰ì…˜ìœ¼ë¡œ ë³€ê²½í•œë‹¤. ë§Œ
ì•½ getOrders() ì²˜ëŸ¼ ì„ì˜ì˜ ë©”ì„œë“œì—ì„œ ì»¬ë ¥ì…˜ì„ ì˜ëª» ìƒì„±í•˜ë©´ í•˜ğŸ•”ë²„ë„¤ğŸ•”íŠ¸ ë‚´ë¶€ ë©”ì»¤ë‹ˆì¦˜ì— ë¬¸ì œê°€ ë°œìƒ
í•  ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ í•„ë“œë ˆë²¨ì—ì„œ ìƒì„±í•˜ëŠ” ê²ƒğŸ•” ê°€ì¥ ì•ˆì „í•˜ê³ , ì½”ë“œë„ ê°„ê²°í•˜ë‹¤.

```

Member member = new Member();
System.out.println(member.getOrders().getClass());
em.persist(member);
System.out.println(member.getOrders().getClass());

//ì¶œë ¥  ê²°ê³¼

class java.util.ArrayList

class org.hibernate.collection.internal.PersistentBag

```

í…Œì´ë¸”, ì»¬ëŸ¼ëª… ìƒì„± ì „ëµ

ìŠ¤í”„ë§ ë¶€íŠ¸ì—ì„œ í•˜ğŸ•”ë²„ë„¤ğŸ•”íŠ¸ ê¸°ë³¸ ë§¤í•‘ ì „ëµì„ ë³€ê²½í•´ì„œ ì‹¤ì œ í…ŒğŸ•”ë¸” í•„ë“œëª…ì€ ë‹¤ë¦„

https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#howto-

configure-hibernate-naming-strategy
http://docs.jboss.org/hibernate/orm/5.4/userguide/html_single/


Hibernate_User_Guide.html#naming

í•˜ğŸ•”ë²„ë„¤ğŸ•”íŠ¸ ê¸°ì¡´ êµ¬í˜„: ì—”í‹°í‹°ì˜ í•„ë“œëª…ì„ ê·¸ëŒ€ë¡œ í…ŒğŸ•”ë¸”ì˜ ì»¬ëŸ¼ëª…ìœ¼ë¡œ ì‚¬ìš©

( SpringPhysicalNamingStrategy )

ìŠ¤í”„ë§ ë¶€íŠ¸ ì‹ ê·œ ì„¤ì • (ì—”í‹°í‹°(í•„ë“œ)     í…ŒğŸ•”ë¸”(ì»¬ëŸ¼))

1.   ì¹´ë©œ ì¼€ğŸ•”ìŠ¤    ì–¸ë”ìŠ¤ì½”ì–´(memberPoint     member_point)

2.   .(ì )     _(ì–¸ë”ìŠ¤ì½”ì–´)

3.   ëŒ€ë¬¸ì    ì†Œë¬¸ì

**ì ìš© 2 ë‹¨ê³„**

1.   ë…¼ë¦¬ëª… ìƒì„±: ëª…ì‹œì ìœ¼ë¡œ ì»¬ëŸ¼, í…ŒğŸ•”ë¸”ëª…ì„ ì§ì ‘ ì ì§€ ì•Šìœ¼ë©´ ImplicitNamingStrategy ì‚¬ìš©

spring.jpa.hibernate.naming.implicit-strategy : í…ŒğŸ•”ë¸”ğŸ•”ë‚˜, ì»¬ëŸ¼ëª…ì„ ëª…ì‹œí•˜ì§€ ì•Šì„ ë•Œ ë…¼ë¦¬ëª… ì 
ìš©,

2.   ë¬¼ë¦¬ëª… ì ìš©:

spring.jpa.hibernate.naming.physical-strategy : ëª¨ë“  ë…¼ë¦¬ëª…ì— ì ìš©ë¨, ì‹¤ì œ í…ŒğŸ•”ë¸”ì— ì ìš©

(username     usernm ë“±ìœ¼ë¡œ íšŒì‚¬ ë£°ë¡œ ë°”ê¿€ ìˆ˜ ìˆìŒ)

**ìŠ¤í”„ë§ ë¶€íŠ¸ ê¸°ë³¸ ì„¤ì •**

spring.jpa.hibernate.naming.implicit-strategy:
org.springframework.boot.orm.jpa.hibernate.SpringImplicitNamingStrategy
spring.jpa.hibernate.naming.physical-strategy:
org.springframework.boot.orm.jpa.hibernate.SpringPhysicalNamingStrategy


3. ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬í˜„ ì¤€ë¹„

#1.ì¸ê°•/jpaí™œìš©í¸/í™œìš©í¸1/ê°•ì˜

/êµ¬í˜„ ìš”êµ¬ì‚¬í•­

/ì• í”Œë¦¬ì¼€ğŸ•”ì…˜ ì•„í‚¤í…ì²˜

êµ¬í˜„ ìš”êµ¬ì‚¬í•­

íšŒì› ê¸°ëŠ¥

íšŒì› ë“±ë¡
íšŒì› ì¡°íšŒ

ìƒí’ˆ ê¸°ëŠ¥

ìƒí’ˆ ë“±ë¡
ìƒí’ˆ ìˆ˜ì •


ìƒí’ˆ ì¡°íšŒ
ì£¼ë¬¸ ê¸°ëŠ¥

ìƒí’ˆ ì£¼ë¬¸
ì£¼ë¬¸ ë‚´ì—­ ì¡°íšŒ
ì£¼ë¬¸ ì·¨ì†Œ

**ì˜ˆì œë¥¼ ë‹¨ìˆœí™” í•˜ê¸° ìœ„í•´ ë‹¤ìŒ ê¸°ëŠ¥ì€ êµ¬í˜„X**

ë¡œê·¸ì¸ê³¼ ê¶Œí•œ ê´€ë¦¬X
íŒŒë¼ë¯¸í„° ê²€ì¦ê³¼ ì˜ˆì™¸ ì²˜ë¦¬X
ìƒí’ˆì€ ë„ì„œë§Œ ì‚¬ìš©
ì¹´í…Œê³ ë¦¬ëŠ” ì‚¬ìš©X

ë°°ì†¡ ì •ë³´ëŠ” ì‚¬ìš©X

ì• í”Œë¦¬ì¼€ì´ì…˜ ì•„í‚¤í…ì²˜

**ê³„ì¸µí˜• êµ¬ì¡° ì‚¬ìš©**

controller, web: ì›¹ ê³„ì¸µ

service: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, íŠ¸ëœì­ì…˜ ì²˜ë¦¬

repository: JPAë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ëŠ” ê³„ì¸µ, ì—”í‹°í‹° ë§¤ë‹ˆì € ì‚¬ìš©

domain: ì—”í‹°í‹°ê°€ ëª¨ì—¬ ìˆëŠ” ê³„ì¸µ, ëª¨ë“  ê³„ì¸µì—ì„œ ì‚¬ìš©

**íŒ¨í‚¤ì§€ êµ¬ì¡°**

jpabook.jpashop
domain
exception
repository
service
web


**ê°œë°œ ìˆœì„œ: ì„œë¹„ìŠ¤, ë¦¬í¬ì§€í† ë¦¬ ê³„ì¸µì„ ê°œë°œí•˜ê³ , í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ì‘ì„±í•´ì„œ ê²€ì¦, ë§ˆì§€ë§‰ì— ì›¹ ê³„ì¸µ ì ìš©**


4. íšŒì› ë„ë©”ì¸ ê°œë°œ

#1.ì¸ê°•/jpaí™œìš©í¸/í™œìš©í¸1/ê°•ì˜

/íšŒì› ë¦¬í¬ì§€í† ë¦¬ ê°œë°œ

/íšŒì› ì„œë¹„ìŠ¤ ê°œë°œ

/íšŒì› ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

**êµ¬í˜„ ê¸°ëŠ¥**

íšŒì› ë“±ë¡
íšŒì› ëª©ë¡ ì¡°íšŒ


**ìˆœì„œ**

íšŒì› ì—”í‹°í‹° ì½”ë“œ ë‹¤ì‹œ ë³´ê¸°
íšŒì› ë¦¬í¬ì§€í† ë¦¬ ê°œë°œ
íšŒì› ì„œë¹„ìŠ¤ ê°œë°œ

íšŒì› ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

íšŒì› ë¦¬í¬ì§€í† ë¦¬ ê°œë°œ

**íšŒì› ë¦¬í¬ì§€í† ë¦¬ ì½”ë“œ**

```

package jpabook.jpashop.repository;

import jpabook.jpashop.domain.Member;

import org.springframework.stereotype.Repository;
import javax.persistence.EntityManager;

import javax.persistence.PersistenceContext;
import java.util.List;

@Repository

public class MemberRepository {

@PersistenceContext
private EntityManager em;

public void save(Member member) {
em.persist(member);

}


public Member findOne(Long id) {
return em.find(Member.class, id);

}

public List<Member> findAll() {

return em.createQuery("select m from Member m", Member.class)

.getResultList();

}

public List<Member> findByName(String name) {

return em.createQuery("select m from Member m where m.name = :name",
Member.class)

.setParameter("name", name)

.getResultList();

}

}

```

**ê¸°ìˆ  ì„¤ëª…**

@Repository : ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡, JPA ì˜ˆì™¸ë¥¼ ìŠ¤í”„ë§ ê¸°ë°˜ ì˜ˆì™¸ë¡œ ì˜ˆì™¸ ë³€í™˜
@PersistenceContext : ì—”í‹°í‹° ë©”ë‹ˆì €( EntityManager ) ì£¼ì…
@PersistenceUnit                                 : ì—”í‹°í‹° ë©”ë‹ˆí„° íŒ©í† ë¦¬( EntityManagerFactory ) ì£¼ì…

**ê¸°ëŠ¥ ì„¤ëª…**

save()
findOne()
findAll()
findByName()

íšŒì› ì„œë¹„ìŠ¤ ê°œë°œ

**íšŒì› ì„œë¹„ìŠ¤ ì½”ë“œ**

```

package jpabook.jpashop.service;

import jpabook.jpashop.domain.Member;

import jpabook.jpashop.repository.MemberRepository;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import org.springframework.transaction.annotation.Transactional;
import java.util.List;


@Service
@Transactional(readOnly = true)
public            class MemberService {

@Autowired

MemberRepository memberRepository;

/**

* íšŒì›ê°€ì…

*/

@Transactional //ë³€ê²½

public Long join(Member member) {

validateDuplicateMember(member); //ì¤‘ë³µ  íšŒì›  ê²€ì¦

memberRepository.save(member);
return member.getId();

}

private void validateDuplicateMember(Member member) {
List<Member> findMembers =

memberRepository.findByName(member.getName());
if (!findMembers.isEmpty()) {

throw new IllegalStateException("ğŸ•”ë¯¸  ì¡´ì¬í•˜ëŠ”  íšŒì›ì…ë‹ˆë‹¤.");

}

}

/**

* ì „ì²´  íšŒì›  ì¡°íšŒ

*/

public List<Member> findMembers() {
return memberRepository.findAll();

}

public Member findOne(Long memberId) {

return memberRepository.findOne(memberId);

}

}

```

**ê¸°ìˆ  ì„¤ëª…**

@Service

@Transactional : íŠ¸ëœì­ì…˜, ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸

readOnly=true : ë°ğŸ•”í„°ì˜ ë³€ê²½ğŸ•” ì—†ëŠ” ì½ê¸° ì „ìš© ë©”ì„œë“œì— ì‚¬ìš©, ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ í”ŒëŸ¬ì‹œ í•˜ì§€ ì•Šìœ¼


ë¯€ë¡œ ì•½ê°„ì˜ ì„±ëŠ¥ í–¥ìƒ(ì½ê¸° ì „ìš©ì—ëŠ” ë‹¤ ì ìš©)
ë°ğŸ•”í„°ë² ğŸ•”ìŠ¤ ë“œë¼ğŸ•”ë²„ê°€ ì§€ì›í•˜ë©´ DBì—ì„œ ì„±ëŠ¥ í–¥ìƒ

@Autowired

ìƒì„±ì Injection ë§ğŸ•” ì‚¬ìš©, ìƒì„±ìê°€ í•˜ë‚˜ë©´ ìƒëµ ê°€ëŠ¥

**ê¸°ëŠ¥ ì„¤ëª…**

join()
findMembers()
findOne()

**ì°¸ê³ :**                   ì‹¤ë¬´ì—ì„œëŠ” ê²€ì¦ ë¡œì§ğŸ•” ìˆì–´ë„ ë©€í‹° ì“°ë ˆë“œ ìƒí™©ì„ ê³ ë ¤í•´ì„œ íšŒì› í…ŒğŸ•”ë¸”ì˜ íšŒì›ëª… ì»¬ëŸ¼ì— ìœ ë‹ˆí¬ ì œì•½ ì¡°
ê±´ì„ ì¶”ê°€í•˜ëŠ” ê²ƒğŸ•” ì•ˆì „í•˜ë‹¤.

ì°¸ê³ : ìŠ¤í”„ë§ í•„ë“œ ì£¼ì… ëŒ€ì‹ ì— ìƒì„±ì ì£¼ì…ì„ ì‚¬ìš©í•˜ì.

**í•„ë“œ ì£¼ì…**

```

public class MemberService {

@Autowired

MemberRepository memberRepository;

...

}

```

**ìƒì„±ì ì£¼ì…**

```

public class MemberService {

private final MemberRepository memberRepository;

public MemberService(MemberRepository memberRepository) {
this.memberRepository = memberRepository;

}

...

}

```

ìƒì„±ì ì£¼ì… ë°©ì‹ì„ ê¶Œì¥

ë³€ê²½ ë¶ˆê°€ëŠ¥í•œ ì•ˆì „í•œ ê°ì²´ ìƒì„± ê°€ëŠ¥

ìƒì„±ìê°€ í•˜ë‚˜ë©´,  @Autowired ë¥¼ ìƒëµí•  ìˆ˜ ìˆë‹¤.

final í‚¤ì›Œë“œë¥¼ ì¶”ê°€í•˜ë©´ ì»´íŒŒì¼ ì‹œì ì— memberRepository ë¥¼ ì„¤ì •í•˜ì§€ ì•ŠëŠ” ì˜¤ë¥˜ë¥¼ ì²´í¬í•  ìˆ˜ ìˆë‹¤.(ë³´í†µ


ê¸°ë³¸ ìƒì„±ìë¥¼ ì¶”ê°€í•  ë•Œ ë°œê²¬)

**lombok**

```

@RequiredArgsConstructor
public class MemberService {


}

```

private final MemberRepository memberRepository;

...

ì°¸ê³ : ìŠ¤í”„ë§ ë°ğŸ•”í„° JPAë¥¼ ì‚¬ìš©í•˜ë©´ EntityManager ë„ ì£¼ì… ê°€ëŠ¥

```

@Repository
@RequiredArgsConstructor

public class MemberRepository {

private final EntityManager em;

...

}

```

MemberService ìµœì¢… ì½”ë“œ

```

@Service
@Transactional(readOnly = true)
@RequiredArgsConstructor

public class MemberService {

private final MemberRepository memberRepository;

/**

* íšŒì›ê°€ì…

*/

@Transactional //ë³€ê²½

public Long join(Member member) {

validateDuplicateMember(member); //ì¤‘ë³µ  íšŒì›  ê²€ì¦

memberRepository.save(member);
return member.getId();

}

private void validateDuplicateMember(Member member) {
List<Member> findMembers =


memberRepository.findByName(member.getName());
if (!findMembers.isEmpty()) {

throw new IllegalStateException("ğŸ•”ë¯¸  ì¡´ì¬í•˜ëŠ”  íšŒì›ì…ë‹ˆë‹¤.");

}

}

/**

* ì „ì²´  íšŒì›  ì¡°íšŒ

*/

public List<Member> findMembers() {
return memberRepository.findAll();

}

public Member findOne(Long memberId) {

return memberRepository.findOne(memberId);

}

}

```

íšŒì› ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

**í…ŒìŠ¤íŠ¸ ìš”êµ¬ì‚¬í•­**

íšŒì›ê°€ì…ì„ ì„±ê³µí•´ì•¼ í•œë‹¤.

íšŒì›ê°€ì… í•  ë•Œ ê°™ì€ ğŸ•”ë¦„ğŸ•” ìˆìœ¼ë©´ ì˜ˆì™¸ê°€ ë°œìƒí•´ì•¼ í•œë‹¤.

**íšŒì›ê°€ì… í…ŒìŠ¤íŠ¸ ì½”ë“œ**

```

package jpabook.jpashop.service;

import jpabook.jpashop.domain.Member;

import jpabook.jpashop.repository.MemberRepository;
import org.junit.Test;

import org.junit.runner.RunWith;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit4.SpringRunner;
import org.springframework.transaction.annotation.Transactional;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.fail;

@RunWith(SpringRunner.class)
@SpringBootTest


@Transactional

public class MemberServiceTest {

@Autowired MemberService memberService;
@Autowired MemberRepository memberRepository;

@Test

public void íšŒì›ê°€ì…() throws Exception {

//Given

Member member = new Member();
member.setName("kim");

//When

Long saveId = memberService.join(member);

//Then

assertEquals(member, memberRepository.findOne(saveId));

}

@Test(expected = IllegalStateException.class)
public void ì¤‘ë³µ_íšŒì›_ì˜ˆì™¸() throws Exception {

//Given

Member member1 = new Member();
member1.setName("kim");

Member member2 = new Member();
member2.setName("kim");

//When
memberService.join(member1);

memberService.join(member2); //ì˜ˆì™¸ê°€  ë°œìƒí•´ì•¼  í•œë‹¤.

//Then

fail("ì˜ˆì™¸ê°€  ë°œìƒí•´ì•¼  í•œë‹¤.");

}

}

```

**ê¸°ìˆ  ì„¤ëª…**

@RunWith(SpringRunner.class) : ìŠ¤í”„ë§ê³¼ í…ŒìŠ¤íŠ¸ í†µí•©

@SpringBootTest : ìŠ¤í”„ë§ ë¶€íŠ¸ ë„ìš°ê³  í…ŒìŠ¤íŠ¸(ğŸ•”ê²Œ ì—†ìœ¼ë©´ @Autowired ë‹¤ ì‹¤íŒ¨)


@Transactional : ë°˜ë³µ ê°€ëŠ¥í•œ í…ŒìŠ¤íŠ¸ ì§€ì›, ê°ê°ì˜ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•  ë•Œë§ˆë‹¤ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ê³  **í…ŒìŠ¤íŠ¸ê°€
ëë‚˜ë©´ íŠ¸ëœì­ì…˜ì„ ê°•ì œë¡œ ë¡¤ë°±**                   (ğŸ•” ì–´ë…¸í…ŒğŸ•”ì…˜ğŸ•” í…ŒìŠ¤íŠ¸ ì¼€ğŸ•”ìŠ¤ì—ì„œ ì‚¬ìš©ë  ë•Œë§Œ ë¡¤ë°±)

**ê¸°ëŠ¥ ì„¤ëª…**

íšŒì›ê°€ì… í…ŒìŠ¤íŠ¸

ì¤‘ë³µ íšŒì› ì˜ˆì™¸ì²˜ë¦¬ í…ŒìŠ¤íŠ¸

ì°¸ê³ : í…ŒìŠ¤íŠ¸ ì¼€ğŸ•”ìŠ¤ ì‘ì„± ê³ ìˆ˜ ë˜ëŠ” ë§ˆë²•: Given, When, Then
(http://martinfowler.com/bliki/GivenWhenThen.html)

ğŸ•” ë°©ë²•ğŸ•” í•„ìˆ˜ëŠ” ì•„ë‹ˆì§€ë§Œ ğŸ•” ë°©ë²•ì„ ê¸°ë³¸ìœ¼ë¡œ í•´ì„œ ë‹¤ì–‘í•˜ê²Œ ì‘ìš©í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•œë‹¤.

í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ìœ„í•œ ì„¤ì •

í…ŒìŠ¤íŠ¸ëŠ” ì¼€ğŸ•”ìŠ¤ ê²©ë¦¬ëœ í™˜ê²½ì—ì„œ ì‹¤í–‰í•˜ê³ , ëë‚˜ë©´ ë°ğŸ•”í„°ë¥¼ ì´ˆê¸°í™”í•˜ëŠ” ê²ƒğŸ•” ì¢‹ë‹¤. ê·¸ëŸ° ë©´ì—ì„œ ë©”ëª¨ë¦¬ DBë¥¼ ì‚¬ìš©í•˜
ëŠ” ê²ƒğŸ•” ê°€ì¥ ğŸ•”ìƒì ğŸ•”ë‹¤.

ì¶”ê°€ë¡œ í…ŒìŠ¤íŠ¸ ì¼€ğŸ•”ìŠ¤ë¥¼ ìœ„í•œ ìŠ¤í”„ë§ í™˜ê²½ê³¼, ì¼ë°˜ì ìœ¼ë¡œ ì• í”Œë¦¬ì¼€ğŸ•”ì…˜ì„ ì‹¤í–‰í•˜ëŠ” í™˜ê²½ì€ ë³´í†µ ë‹¤ë¥´ë¯€ë¡œ ì„¤ì • íŒŒì¼ì„
ë‹¤ë¥´ê²Œ ì‚¬ìš©í•˜ì.

ë‹¤ìŒê³¼ ê°™ğŸ•” ê°„ë‹¨í•˜ê²Œ í…ŒìŠ¤íŠ¸ìš© ì„¤ì • íŒŒì¼ì„ ì¶”ê°€í•˜ë©´ ëœë‹¤.

test/resources/application.yml

```ya

spring:

#  datasource:

#    url: jdbc:h2:mem:testdb
#    username: sa

#    password:

#    driver-class-name: org.h2.Driver

#  jpa:

#    hibernate:

#      ddl-auto: create
#    properties:

#      hibernate:

#        show_sql: true

#        format_sql: true
#    open-in-view: false

logging.level:
org.hibernate.SQL: debug

#  org.hibernate.type: trace


```

ğŸ•”ì œ í…ŒìŠ¤íŠ¸ì—ì„œ ìŠ¤í”„ë§ì„ ì‹¤í–‰í•˜ë©´ ğŸ•” ìœ„ì¹˜ì— ìˆëŠ” ì„¤ì • íŒŒì¼ì„ ì½ëŠ”ë‹¤.
(ë§Œì•½ ğŸ•” ìœ„ì¹˜ì— ì—†ìœ¼ë©´ src/resources/application.yml ì„ ì½ëŠ”ë‹¤.)

ìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” datasource ì„¤ì •ğŸ•” ì—†ìœ¼ë©´, ê¸°ë³¸ì ì„ ë©”ëª¨ë¦¬ DBë¥¼ ì‚¬ìš©í•˜ê³ , driver-classë„ í˜„ì¬ ë“±ë¡ëœ ë¼ğŸ•”ë¸ŒëŸ¬ë¥¼
ë³´ê³  ì°¾ì•„ì¤€ë‹¤. ì¶”ê°€ë¡œ ddl-auto ë„ create-drop ëª¨ë“œë¡œ ë™ì‘í•œë‹¤. ë”°ë¼ì„œ ë°ğŸ•”í„°ì†ŒìŠ¤ë‚˜, JPA ê´€ë ¨ëœ ë³„ë„ì˜ ì¶”
ê°€ ì„¤ì •ì„ í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.


5. ìƒí’ˆ ë„ë©”ì¸ ê°œë°œ

#1.ì¸ê°•/jpaí™œìš©í¸/í™œìš©í¸1/ê°•ì˜

/ìƒí’ˆ ì—”í‹°í‹° ê°œë°œ(ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì¶”ê°€)

/ìƒí’ˆ ë¦¬í¬ì§€í† ë¦¬ ê°œë°œ

/ìƒí’ˆ ì„œë¹„ìŠ¤ ê°œë°œ

**êµ¬í˜„ ê¸°ëŠ¥**

ìƒí’ˆ ë“±ë¡
ìƒí’ˆ ëª©ë¡ ì¡°íšŒ
ìƒí’ˆ ìˆ˜ì •


**ìˆœì„œ**

ìƒí’ˆ ì—”í‹°í‹° ê°œë°œ(ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì¶”ê°€)
ìƒí’ˆ ë¦¬í¬ì§€í† ë¦¬ ê°œë°œ

ìƒí’ˆ ì„œë¹„ìŠ¤ ê°œë°œ
ìƒí’ˆ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

ìƒí’ˆ ì—”í‹°í‹° ê°œë°œ(ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì¶”ê°€)

**ìƒí’ˆ ì—”í‹°í‹° ì½”ë“œ**

```

package jpabook.jpashop.domain.item;

import jpabook.jpashop.exception.NotEnoughStockException;
import lombok.Getter;

import lombok.Setter;

import jpabook.jpashop.domain.Category;
import javax.persistence.*;

import java.util.ArrayList;
import java.util.List;

@Entity

@Inheritance(strategy = InheritanceType.SINGLE_TABLE)
@DiscriminatorColumn(name = "dtype")

@Getter @Setter

public abstract class Item {


@Id @GeneratedValue
@Column(name = "item_id")
private Long id;

private String name;
private int price;

private int stockQuantity;

@ManyToMany(mappedBy = "items")

private List<Category> categories = new ArrayList<Category>();

//==ë¹„ì¦ˆë‹ˆìŠ¤  ë¡œì§==//

public void addStock(int quantity) {
this.stockQuantity += quantity;

}

public void removeStock(int quantity) {

int restStock = this.stockQuantity - quantity;
if (restStock < 0) {

throw new NotEnoughStockException("need more stock");

}

this.stockQuantity = restStock;

}

}

```

**ì˜ˆì™¸ ì¶”ê°€**

```

package jpabook.jpashop.exception;

public class NotEnoughStockException extends RuntimeException {
public NotEnoughStockException() {

}

public NotEnoughStockException(String message) {
super(message);

}

public NotEnoughStockException(String message, Throwable cause) {
super(message, cause);

}


public NotEnoughStockException(Throwable cause) {
super(cause);

}

}

```

**ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë¶„ì„**

addStock() ë©”ì„œë“œëŠ” íŒŒë¼ë¯¸í„°ë¡œ ë„˜ì–´ì˜¨ ìˆ˜ë§Œí¼ ì¬ê³ ë¥¼ ëŠ˜ë¦°ë‹¤. ğŸ•” ë©”ì„œë“œëŠ” ì¬ê³ ê°€ ì¦ê°€í•˜ê±°ë‚˜ ìƒí’ˆ ì£¼ë¬¸ì„
ì·¨ì†Œí•´ì„œ ì¬ê³ ë¥¼ ë‹¤ì‹œ ëŠ˜ë ¤ì•¼ í•  ë•Œ ì‚¬ìš©í•œë‹¤.

removeStock() ë©”ì„œë“œëŠ” íŒŒë¼ë¯¸í„°ë¡œ ë„˜ì–´ì˜¨ ìˆ˜ë§Œí¼ ì¬ê³ ë¥¼ ì¤„ì¸ë‹¤. ë§Œì•½ ì¬ê³ ê°€ ë¶€ì¡±í•˜ë©´ ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤.
ì£¼ë¡œ ìƒí’ˆì„ ì£¼ë¬¸í•  ë•Œ ì‚¬ìš©í•œë‹¤.

ìƒí’ˆ ë¦¬í¬ì§€í† ë¦¬ ê°œë°œ

**ìƒí’ˆ ë¦¬í¬ì§€í† ë¦¬ ì½”ë“œ**

```

package jpabook.jpashop.repository;

import jpabook.jpashop.domain.item.Item;
import lombok.RequiredArgsConstructor;

import org.springframework.stereotype.Repository;

import javax.persistence.EntityManager;
import java.util.List;

@Repository
@RequiredArgsConstructor
public                          class ItemRepository {

private final EntityManager em;

public void save(Item item) {
if (item.getId() == null) {

em.persist(item);

} else {

em.merge(item);

}

}

public Item findOne(Long id) {


return em.find(Item.class, id);

}

public List<Item> findAll() {

return em.createQuery("select i from Item
i",Item.class).getResultList();

}

}

```

**ê¸°ëŠ¥ ì„¤ëª…**

save()

id ê°€ ì—†ìœ¼ë©´ ì‹ ê·œë¡œ ë³´ê³  persist() ì‹¤í–‰

id ê°€ ìˆìœ¼ë©´ ğŸ•”ë¯¸ ë°ğŸ•”í„°ë² ğŸ•”ìŠ¤ì— ì €ì¥ëœ ì—”í‹°í‹°ë¥¼ ìˆ˜ì •í•œë‹¤ê³  ë³´ê³ ,  merge() ë¥¼ ì‹¤í–‰,  ìì„¸í•œ ë‚´ìš©ì€
ë’¤ì— ì›¹ì—ì„œ ì„¤ëª…(ê·¸ëƒ¥ ì§€ê¸ˆì€ ì €ì¥í•œë‹¤ ì •ë„ë¡œ ìƒê°í•˜ì)

ìƒí’ˆ ì„œë¹„ìŠ¤ ê°œë°œ

**ìƒí’ˆ ì„œë¹„ìŠ¤ ì½”ë“œ**

```

package jpabook.jpashop.service;

import jpabook.jpashop.domain.item.Item;

import jpabook.jpashop.repository.ItemRepository;
import lombok.RequiredArgsConstructor;

import org.springframework.stereotype.Service;

import org.springframework.transaction.annotation.Transactional;
import java.util.List;

@Service
@Transactional(readOnly = true)
@RequiredArgsConstructor

public class ItemService {

private final ItemRepository itemRepository;
@Transactional

public void saveItem(Item item) {
itemRepository.save(item);

}

public List<Item> findItems() {


return itemRepository.findAll();

}

public Item findOne(Long itemId) {

return itemRepository.findOne(itemId);

}

}

```

ìƒí’ˆ ì„œë¹„ìŠ¤ëŠ” ìƒí’ˆ ë¦¬í¬ì§€í† ë¦¬ì— ë‹¨ìˆœíˆ ìœ„ì„ë§Œ í•˜ëŠ” í´ë˜ìŠ¤

ìƒí’ˆ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

ìƒí’ˆ í…ŒìŠ¤íŠ¸ëŠ” íšŒì› í…ŒìŠ¤íŠ¸ì™€ ë¹„ìŠ·í•˜ë¯€ë¡œ ìƒëµ


6. ì£¼ë¬¸ ë„ë©”ì¸ ê°œë°œ

#1.ì¸ê°•/jpaí™œìš©í¸/í™œìš©í¸1/ê°•ì˜

/ì£¼ë¬¸, ì£¼ë¬¸ìƒí’ˆ ì—”í‹°í‹° ê°œë°œ

/ì£¼ë¬¸ ë¦¬í¬ì§€í† ë¦¬ ê°œë°œ

/ì£¼ë¬¸ ì„œë¹„ìŠ¤ ê°œë°œ

/ì£¼ë¬¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

/ì£¼ë¬¸ ê²€ìƒ‰ ê¸°ëŠ¥ ê°œë°œ

**êµ¬í˜„ ê¸°ëŠ¥**

ìƒí’ˆ ì£¼ë¬¸
ì£¼ë¬¸ ë‚´ì—­ ì¡°íšŒ
ì£¼ë¬¸ ì·¨ì†Œ


**ìˆœì„œ**

ì£¼ë¬¸ ì—”í‹°í‹°, ì£¼ë¬¸ìƒí’ˆ ì—”í‹°í‹° ê°œë°œ
ì£¼ë¬¸ ë¦¬í¬ì§€í† ë¦¬ ê°œë°œ

ì£¼ë¬¸ ì„œë¹„ìŠ¤ ê°œë°œ
ì£¼ë¬¸ ê²€ìƒ‰ ê¸°ëŠ¥ ê°œë°œ
ì£¼ë¬¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

ì£¼ë¬¸, ì£¼ë¬¸ìƒí’ˆ ì—”í‹°í‹° ê°œë°œ

ì£¼ë¬¸ ì—”í‹°í‹° ê°œë°œ

**ì£¼ë¬¸ ì—”í‹°í‹° ì½”ë“œ**

```

package jpabook.jpashop.domain;

import lombok.Getter;
import lombok.Setter;

import javax.persistence.*;
import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.List;


@Entity

@Table(name = "orders")
@Getter @Setter

public class Order {

@Id @GeneratedValue
@Column(name = "order_id")
private Long id;

@ManyToOne(fetch = FetchType.LAZY)
@JoinColumn(name = "member_id")
private      Member member; //ì£¼ë¬¸  íšŒì›

@OneToMany(mappedBy = "order", cascade = CascadeType.ALL)
private List<OrderItem> orderItems = new ArrayList<>();

@OneToOne(cascade = CascadeType.ALL, fetch = FetchType.LAZY)
@JoinColumn(name = "delivery_id")

private Delivery delivery; //ë°°ì†¡ì •ë³´

private LocalDateTime orderDate; //ì£¼ë¬¸ì‹œê°„
@Enumerated(EnumType.STRING)

private OrderStatus status; //ì£¼ë¬¸ìƒíƒœ  [ORDER, CANCEL]

//==ì—°ê´€ê´€ê³„  ë©”ì„œë“œ==//

public void setMember(Member member) {
this.member = member;
member.getOrders().add(this);

}

public void addOrderItem(OrderItem orderItem) {
orderItems.add(orderItem);
orderItem.setOrder(this);

}

public void setDelivery(Delivery delivery) {
this.delivery = delivery;
delivery.setOrder(this);

}

//==ìƒì„±  ë©”ì„œë“œ==//

public static Order createOrder(Member member, Delivery delivery,


OrderItem... orderItems) {

Order order = new Order();
order.setMember(member);
order.setDelivery(delivery);

for (OrderItem orderItem : orderItems) {
order.addOrderItem(orderItem);

}

order.setStatus(OrderStatus.ORDER);
order.setOrderDate(LocalDateTime.now());
return                                    order;

}

//==ë¹„ì¦ˆë‹ˆìŠ¤  ë¡œì§==//

/** ì£¼ë¬¸  ì·¨ì†Œ  */

public void cancel() {

if (delivery.getStatus() == DeliveryStatus.COMP) {

throw new IllegalStateException("ğŸ•”ë¯¸  ë°°ì†¡ì™„ë£Œëœ  ìƒí’ˆì€  ì·¨ì†Œê°€  ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.");

}

this.setStatus(OrderStatus.CANCEL);

for (OrderItem orderItem : orderItems) {
orderItem.cancel();

}

}

//==ì¡°íšŒ  ë¡œì§==//

/** ì „ì²´  ì£¼ë¬¸  ê°€ê²©  ì¡°íšŒ  */
public int getTotalPrice() {

int totalPrice = 0;

for (OrderItem orderItem : orderItems) {
totalPrice += orderItem.getTotalPrice();

}

return totalPrice;

}

}

```

**ê¸°ëŠ¥ ì„¤ëª…**

**ìƒì„± ë©”ì„œë“œ**( createOrder() ): ì£¼ë¬¸ ì—”í‹°í‹°ë¥¼ ìƒì„±í•  ë•Œ ì‚¬ìš©í•œë‹¤. ì£¼ë¬¸ íšŒì›, ë°°ì†¡ì •ë³´, ì£¼ë¬¸ìƒí’ˆì˜ ì •ë³´ë¥¼
ë°›ì•„ì„œ ì‹¤ì œ ì£¼ë¬¸ ì—”í‹°í‹°ë¥¼ ìƒì„±í•œë‹¤.

**ì£¼ë¬¸ ì·¨ì†Œ**( cancel() ): ì£¼ë¬¸ ì·¨ì†Œì‹œ ì‚¬ìš©í•œë‹¤. ì£¼ë¬¸ ìƒíƒœë¥¼ ì·¨ì†Œë¡œ ë³€ê²½í•˜ê³  ì£¼ë¬¸ìƒí’ˆì— ì£¼ë¬¸ ì·¨ì†Œë¥¼ ì•Œë¦°ë‹¤. ë§Œ
ì•½ ğŸ•”ë¯¸ ë°°ì†¡ì„ ì™„ë£Œí•œ ìƒí’ˆğŸ•”ë©´ ì£¼ë¬¸ì„ ì·¨ì†Œí•˜ì§€ ëª»í•˜ë„ë¡ ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚¨ë‹¤.


**ì „ì²´ ì£¼ë¬¸ ê°€ê²© ì¡°íšŒ:**                   ì£¼ë¬¸ ì‹œ ì‚¬ìš©í•œ ì „ì²´ ì£¼ë¬¸ ê°€ê²©ì„ ì¡°íšŒí•œë‹¤. ì „ì²´ ì£¼ë¬¸ ê°€ê²©ì„ ì•Œë ¤ë©´ ê°ê°ì˜ ì£¼ë¬¸ìƒí’ˆ ê°€ê²©
ì„ ì•Œì•„ì•¼ í•œë‹¤. ë¡œì§ì„ ë³´ë©´ ì—°ê´€ëœ ì£¼ë¬¸ìƒí’ˆë“¤ì˜ ê°€ê²©ì„ ì¡°íšŒí•´ì„œ ë”í•œ ê°’ì„ ë°˜í™˜í•œë‹¤. (ì‹¤ë¬´ì—ì„œëŠ” ì£¼ë¡œ ì£¼ë¬¸ì—
ì „ì²´ ì£¼ë¬¸ ê°€ê²© í•„ë“œë¥¼ ë‘ê³  ì—­ì •ê·œí™” í•œë‹¤.)

ì£¼ë¬¸ìƒí’ˆ ì—”í‹°í‹° ê°œë°œ

**ì£¼ë¬¸ìƒí’ˆ ì—”í‹°í‹° ì½”ë“œ**

```

package jpabook.jpashop.domain;

import lombok.Getter;
import lombok.Setter;

import jpabook.jpashop.domain.item.Item;
import javax.persistence.*;

@Entity

@Table(name = "order_item")
@Getter @Setter

public class OrderItem {

@Id @GeneratedValue
@Column(name = "order_item_id")
private Long id;

@ManyToOne(fetch = FetchType.LAZY)
@JoinColumn(name = "item_id")
private          Item item;      //ì£¼ë¬¸  ìƒí’ˆ

@ManyToOne(fetch = FetchType.LAZY)
@JoinColumn(name = "order_id")
private        Order order;    //ì£¼ë¬¸

private int orderPrice; //ì£¼ë¬¸  ê°€ê²©

private int count;      //ì£¼ë¬¸  ìˆ˜ëŸ‰

//==ìƒì„±  ë©”ì„œë“œ==//

public static OrderItem createOrderItem(Item item, int orderPrice, int
count) {

OrderItem orderItem = new OrderItem();
orderItem.setItem(item);
orderItem.setOrderPrice(orderPrice);
orderItem.setCount(count);


item.removeStock(count);
return orderItem;

}

//==ë¹„ì¦ˆë‹ˆìŠ¤  ë¡œì§==//

/** ì£¼ë¬¸  ì·¨ì†Œ  */

public void cancel() {
getItem().addStock(count);

}

//==ì¡°íšŒ  ë¡œì§==//

/** ì£¼ë¬¸ìƒí’ˆ  ì „ì²´  ê°€ê²©  ì¡°íšŒ  */
public int getTotalPrice() {

return getOrderPrice() * getCount();

}

}

```

**ê¸°ëŠ¥ ì„¤ëª…**

**ìƒì„± ë©”ì„œë“œ**( createOrderItem() ): ì£¼ë¬¸ ìƒí’ˆ, ê°€ê²©, ìˆ˜ëŸ‰ ì •ë³´ë¥¼ ì‚¬ìš©í•´ì„œ ì£¼ë¬¸ìƒí’ˆ ì—”í‹°í‹°ë¥¼ ìƒì„±í•œë‹¤. ê·¸
ë¦¬ê³  item.removeStock(count) ë¥¼ í˜¸ì¶œí•´ì„œ ì£¼ë¬¸í•œ ìˆ˜ëŸ‰ë§Œí¼ ìƒí’ˆì˜ ì¬ê³ ë¥¼ ì¤„ì¸ë‹¤.

**ì£¼ë¬¸ ì·¨ì†Œ**( cancel() ):  getItem().addStock(count) ë¥¼ í˜¸ì¶œí•´ì„œ ì·¨ì†Œí•œ ì£¼ë¬¸ ìˆ˜ëŸ‰ë§Œí¼ ìƒí’ˆì˜ ì¬ê³ ë¥¼
ì¦ê°€ì‹œí‚¨ë‹¤.

**ì£¼ë¬¸ ê°€ê²© ì¡°íšŒ**( getTotalPrice() ): ì£¼ë¬¸ ê°€ê²©ì— ìˆ˜ëŸ‰ì„ ê³±í•œ ê°’ì„ ë°˜í™˜í•œë‹¤.

ì£¼ë¬¸ ë¦¬í¬ì§€í† ë¦¬ ê°œë°œ

**ì£¼ë¬¸ ë¦¬í¬ì§€í† ë¦¬ ì½”ë“œ**

```

package jpabook.jpashop.repository;

import jpabook.jpashop.domain.Order;
import lombok.RequiredArgsConstructor;

import org.springframework.stereotype.Repository;
import javax.persistence.EntityManager;

@Repository
@RequiredArgsConstructor


public class OrderRepository {
private final EntityManager em;

public void save(Order order) {
em.persist(order);

}

public Order findOne(Long id) {
return em.find(Order.class, id);

}

//    public List<Order> findAll(OrderSearch orderSearch) { ... }

}

```

ì£¼ë¬¸ ë¦¬í¬ì§€í† ë¦¬ì—ëŠ” ì£¼ë¬¸ ì—”í‹°í‹°ë¥¼ ì €ì¥í•˜ê³  ê²€ìƒ‰í•˜ëŠ” ê¸°ëŠ¥ğŸ•” ìˆë‹¤. ë§ˆì§€ë§‰ì˜ findAll(OrderSearch
orderSearch) ë©”ì„œë“œëŠ” ì¡°ê¸ˆ ë’¤ì— ìˆëŠ” ì£¼ë¬¸ ê²€ìƒ‰ ê¸°ëŠ¥ì—ì„œ ìì„¸íˆ ì•Œì•„ë³´ì.

ì£¼ë¬¸ ì„œë¹„ìŠ¤ ê°œë°œ

**ì£¼ë¬¸ ì„œë¹„ìŠ¤ ì½”ë“œ**

```

package jpabook.jpashop.service;

import jpabook.jpashop.domain.Delivery;
import jpabook.jpashop.domain.Member;
import jpabook.jpashop.domain.Order;
import jpabook.jpashop.domain.OrderItem;
import jpabook.jpashop.domain.item.Item;

import jpabook.jpashop.repository.ItemRepository;
import jpabook.jpashop.repository.MemberRepository;
import jpabook.jpashop.repository.OrderRepository;
import lombok.RequiredArgsConstructor;

import org.springframework.stereotype.Service;

import org.springframework.transaction.annotation.Transactional;

@Service
@Transactional(readOnly = true)
@RequiredArgsConstructor


public class OrderService {

private final MemberRepository memberRepository;
private final OrderRepository orderRepository;
private final ItemRepository itemRepository;

/** ì£¼ë¬¸  */
@Transactional

public Long order(Long memberId, Long itemId, int count) {

//ì—”í‹°í‹°  ì¡°íšŒ

Member member = memberRepository.findOne(memberId);
Item item = itemRepository.findOne(itemId);

//ë°°ì†¡ì •ë³´  ìƒì„±

Delivery delivery = new Delivery();
delivery.setAddress(member.getAddress());
delivery.setStatus(DeliveryStatus.READY);


count);

}

//ì£¼ë¬¸ìƒí’ˆ  ìƒì„±

OrderItem orderItem = OrderItem.createOrderItem(item, item.getPrice(),

//ì£¼ë¬¸  ìƒì„±

Order order = Order.createOrder(member, delivery, orderItem);

//ì£¼ë¬¸  ì €ì¥
orderRepository.save(order);
return                order.getId();

/** ì£¼ë¬¸  ì·¨ì†Œ  */
@Transactional

public void cancelOrder(Long orderId) {

//ì£¼ë¬¸  ì—”í‹°í‹°  ì¡°íšŒ

Order order = orderRepository.findOne(orderId);

//ì£¼ë¬¸  ì·¨ì†Œ

order.cancel();

}

/** ì£¼ë¬¸  ê²€ìƒ‰  */

/*

public List<Order> findOrders(OrderSearch orderSearch) {


return orderRepository.findAll(orderSearch);

}

*/

}

```

ì£¼ë¬¸ ì„œë¹„ìŠ¤ëŠ” ì£¼ë¬¸ ì—”í‹°í‹°ì™€ ì£¼ë¬¸ ìƒí’ˆ ì—”í‹°í‹°ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ í™œìš©í•´ì„œ ì£¼ë¬¸, ì£¼ë¬¸ ì·¨ì†Œ, ì£¼ë¬¸ ë‚´ì—­ ê²€ìƒ‰ ê¸°ëŠ¥ì„ ì œ
ê³µí•œë‹¤.

ì°¸ê³ : ì˜ˆì œë¥¼ ë‹¨ìˆœí™”í•˜ë ¤ê³  í•œ ë²ˆì— í•˜ë‚˜ì˜ ìƒí’ˆë§Œ ì£¼ë¬¸í•  ìˆ˜ ìˆë‹¤.

**ì£¼ë¬¸**( order() ): ì£¼ë¬¸í•˜ëŠ” íšŒì› ì‹ë³„ì, ìƒí’ˆ ì‹ë³„ì, ì£¼ë¬¸ ìˆ˜ëŸ‰ ì •ë³´ë¥¼ ë°›ì•„ì„œ ì‹¤ì œ ì£¼ë¬¸ ì—”í‹°í‹°ë¥¼ ìƒì„±í•œ í›„ ì €
ì¥í•œë‹¤.

**ì£¼ë¬¸ ì·¨ì†Œ**( cancelOrder() ): ì£¼ë¬¸ ì‹ë³„ìë¥¼ ë°›ì•„ì„œ ì£¼ë¬¸ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•œ í›„ ì£¼ë¬¸ ì—”í‹°í‹°ì— ì£¼ë¬¸ ì·¨ì†Œë¥¼ ìš”ì²­
í•œë‹¤.

**ì£¼ë¬¸ ê²€ìƒ‰**( findOrders() ):  OrderSearch ë¼ëŠ” ê²€ìƒ‰ ì¡°ê±´ì„ ê°€ì§„ ê°ì²´ë¡œ ì£¼ë¬¸ ì—”í‹°í‹°ë¥¼ ê²€ìƒ‰í•œë‹¤. ìì„¸í•œ ë‚´
ìš©ì€ ë‹¤ìŒì— ë‚˜ì˜¤ëŠ” ì£¼ë¬¸ ê²€ìƒ‰ ê¸°ëŠ¥ì—ì„œ ì•Œì•„ë³´ì.

~~                                                                                                  
                                                                                                    
                                                                                                    
                                                                                                    
                 ~~

**ì°¸ê³ :**                   ì£¼ë¬¸ ì„œë¹„ìŠ¤ì˜ ì£¼ë¬¸ê³¼ ì£¼ë¬¸ ì·¨ì†Œ ë©”ì„œë“œë¥¼ ë³´ë©´ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ëŒ€ë¶€ë¶„ğŸ•” ì—”í‹°í‹°ì— ìˆë‹¤. ì„œë¹„ìŠ¤ ê³„ì¸µì€ ë‹¨ìˆœ
íˆ ì—”í‹°í‹°ì— í•„ìš”í•œ ìš”ì²­ì„ ìœ„ì„í•˜ëŠ” ì—­í• ì„ í•œë‹¤. ğŸ•”ì²˜ëŸ¼ ì—”í‹°í‹°ê°€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ê°€ì§€ê³  ê°ì²´ ì§€í–¥ì˜ íŠ¹ì„±ì„
ì ê·¹ í™œìš©í•˜ëŠ” ê²ƒì„ ë„ë©”ì¸ ëª¨ë¸ íŒ¨í„´(http://martinfowler.com/eaaCatalog/domainModel.html)ğŸ•”ë¼ í•œ
ë‹¤. ë°˜ëŒ€ë¡œ ì—”í‹°í‹°ì—ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ğŸ•” ê±°ì˜ ì—†ê³  ì„œë¹„ìŠ¤ ê³„ì¸µì—ì„œ ëŒ€ë¶€ë¶„ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì²˜ë¦¬í•˜ëŠ” ê²ƒì„ íŠ¸
ëœì­ì…˜ ìŠ¤í¬ë¦½íŠ¸ íŒ¨í„´(http://martinfowler.com/eaaCatalog/transactionScript.html)ğŸ•”ë¼ í•œë‹¤.

~~                                                                                                  
                                                                                                    
                                                                                                    
                                                                                                    
                 ~~

ì£¼ë¬¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

**í…ŒìŠ¤íŠ¸ ìš”êµ¬ì‚¬í•­**

ìƒí’ˆ ì£¼ë¬¸ğŸ•” ì„±ê³µí•´ì•¼ í•œë‹¤.

ìƒí’ˆì„ ì£¼ë¬¸í•  ë•Œ ì¬ê³  ìˆ˜ëŸ‰ì„ ì´ˆê³¼í•˜ë©´ ì•ˆ ëœë‹¤.
ì£¼ë¬¸ ì·¨ì†Œê°€ ì„±ê³µí•´ì•¼ í•œë‹¤.

**ìƒí’ˆ ì£¼ë¬¸ í…ŒìŠ¤íŠ¸ ì½”ë“œ**

```

package jpabook.jpashop.service;


import jpabook.jpashop.domain.Address;
import jpabook.jpashop.domain.Member;
import jpabook.jpashop.domain.Order;
import jpabook.jpashop.domain.OrderStatus;
import jpabook.jpashop.domain.item.Book;
import jpabook.jpashop.domain.item.Item;

import jpabook.jpashop.exception.NotEnoughStockException;
import jpabook.jpashop.repository.OrderRepository;

import org.junit.Test;

import org.junit.runner.RunWith;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit4.SpringRunner;
import org.springframework.transaction.annotation.Transactional;

import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.fail;

@RunWith(SpringRunner.class)
@SpringBootTest
@Transactional

public class OrderServiceTest {

@PersistenceContext
EntityManager em;

@Autowired OrderService orderService;
@Autowired OrderRepository orderRepository;

@Test

public void ìƒí’ˆì£¼ë¬¸() throws Exception {

//Given

Member member = createMember();

Item item = createBook("ì‹œê³¨  JPA", 10000, 10); //ğŸ•”ë¦„, ê°€ê²©, ì¬ê³ 

int orderCount = 2;

//When

Long orderId = orderService.order(member.getId(), item.getId(),
orderCount);


//Then

Order getOrder = orderRepository.findOne(orderId);

assertEquals("ìƒí’ˆ  ì£¼ë¬¸ì‹œ  ìƒíƒœëŠ”  ORDER",OrderStatus.ORDER,
getOrder.getStatus());

assertEquals("ì£¼ë¬¸í•œ  ìƒí’ˆ  ì¢…ë¥˜  ìˆ˜ê°€  ì •í™•í•´ì•¼  í•œë‹¤.",1,

getOrder.getOrderItems().size());

assertEquals("ì£¼ë¬¸  ê°€ê²©ì€  ê°€ê²©  * ìˆ˜ëŸ‰ğŸ•”ë‹¤.", 10000 * 2,
getOrder.getTotalPrice());

assertEquals("ì£¼ë¬¸  ìˆ˜ëŸ‰ë§Œí¼  ì¬ê³ ê°€  ì¤„ì–´ì•¼  í•œë‹¤.",8, item.getStockQuantity());

}

@Test(expected = NotEnoughStockException.class)
public void ìƒí’ˆì£¼ë¬¸_ì¬ê³ ìˆ˜ëŸ‰ì´ˆê³¼() throws Exception {

//...

}

@Test

public void ì£¼ë¬¸ì·¨ì†Œ() {

//...

}

private Member createMember() {
Member member = new Member();
member.setName("íšŒì›1");

member.setAddress(new Address("ì„œìš¸", "ê°•ê°€", "123-123"));
em.persist(member);

return member;

}

private Book createBook(String name, int price, int stockQuantity) {
Book book = new Book();

book.setName(name);
book.setStockQuantity(stockQuantity);
book.setPrice(price);
em.persist(book);

return book;

}

}

```

ìƒí’ˆì£¼ë¬¸ğŸ•” ì •ìƒ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” í…ŒìŠ¤íŠ¸ë‹¤. Given ì ˆì—ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ íšŒì›ê³¼ ìƒí’ˆì„ ë§Œë“¤ê³  When ì ˆì—ì„œ ì‹¤


ì œ ìƒí’ˆì„ ì£¼ë¬¸í•˜ê³  Then ì ˆì—ì„œ ì£¼ë¬¸ ê°€ê²©ğŸ•” ì˜¬ë°”ë¥¸ì§€, ì£¼ë¬¸ í›„ ì¬ê³  ìˆ˜ëŸ‰ğŸ•” ì •í™•íˆ ì¤„ì—ˆëŠ”ì§€ ê²€ì¦í•œë‹¤.

**ì¬ê³  ìˆ˜ëŸ‰ ì´ˆê³¼ í…ŒìŠ¤íŠ¸**

ì¬ê³  ìˆ˜ëŸ‰ì„ ì´ˆê³¼í•´ì„œ ìƒí’ˆì„ ì£¼ë¬¸í•´ë³´ì. ğŸ•”ë•ŒëŠ” NotEnoughStockException ì˜ˆì™¸ê°€ ë°œìƒí•´ì•¼ í•œë‹¤.

**ì¬ê³  ìˆ˜ëŸ‰ ì´ˆê³¼ í…ŒìŠ¤íŠ¸ ì½”ë“œ**

```

@Test(expected = NotEnoughStockException.class)
public void ìƒí’ˆì£¼ë¬¸_ì¬ê³ ìˆ˜ëŸ‰ì´ˆê³¼() throws Exception {

//Given

Member member = createMember();

Item item = createBook("ì‹œê³¨  JPA", 10000, 10); //ğŸ•”ë¦„, ê°€ê²©, ì¬ê³ 

int orderCount = 11; //ì¬ê³ ë³´ë‹¤  ë§ì€  ìˆ˜ëŸ‰

//When

orderService.order(member.getId(), item.getId(), orderCount);

//Then

fail("ì¬ê³   ìˆ˜ëŸ‰  ë¶€ì¡±  ì˜ˆì™¸ê°€  ë°œìƒí•´ì•¼  í•œë‹¤.");

}

```

ì½”ë“œë¥¼ ë³´ë©´ ì¬ê³ ëŠ” 10ê¶Œì¸ë° orderCount = 11 ë¡œ ì¬ê³ ë³´ë‹¤ 1ê¶Œ ë” ë§ì€ ìˆ˜ëŸ‰ì„ ì£¼ë¬¸í–ˆë‹¤. ì£¼ë¬¸ ì´ˆê³¼ë¡œ ë‹¤ìŒ ë¡œì§
ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤.

```

public abstract class Item {

//...

public void removeStock(int orderQuantity) {

int restStock = this.stockQuantity - orderQuantity;
if (restStock < 0) {

throw new NotEnoughStockException("need more stock");

}

this.stockQuantity = restStock;

}

}

```


**ì£¼ë¬¸ ì·¨ì†Œ í…ŒìŠ¤íŠ¸**

ì£¼ë¬¸ ì·¨ì†Œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•˜ì. ì£¼ë¬¸ì„ ì·¨ì†Œí•˜ë©´ ê·¸ë§Œí¼ ì¬ê³ ê°€ ì¦ê°€í•´ì•¼ í•œë‹¤.

**ì£¼ë¬¸ ì·¨ì†Œ í…ŒìŠ¤íŠ¸ ì½”ë“œ**

```

@Test

public void ì£¼ë¬¸ì·¨ì†Œ() {

//Given

Member member = createMember();

Item item = createBook("ì‹œê³¨  JPA", 10000, 10); //ğŸ•”ë¦„, ê°€ê²©, ì¬ê³ 

int orderCount = 2;

Long orderId = orderService.order(member.getId(), item.getId(), orderCount);

//When
orderService.cancelOrder(orderId);

//Then

Order getOrder = orderRepository.findOne(orderId);

assertEquals("ì£¼ë¬¸  ì·¨ì†Œì‹œ  ìƒíƒœëŠ”  CANCEL ğŸ•”ë‹¤.",OrderStatus.CANCEL,
getOrder.getStatus());

assertEquals("ì£¼ë¬¸ğŸ•”  ì·¨ì†Œëœ  ìƒí’ˆì€  ê·¸ë§Œí¼  ì¬ê³ ê°€  ì¦ê°€í•´ì•¼  í•œë‹¤.", 10,

item.getStockQuantity());

}

```

ì£¼ë¬¸ì„ ì·¨ì†Œí•˜ë ¤ë©´ ë¨¼ì € ì£¼ë¬¸ì„ í•´ì•¼ í•œë‹¤. Given ì ˆì—ì„œ ì£¼ë¬¸í•˜ê³  When ì ˆì—ì„œ í•´ë‹¹ ì£¼ë¬¸ì„ ì·¨ì†Œí–ˆë‹¤. Then ì ˆì—ì„œ
ì£¼ë¬¸ìƒíƒœê°€ ì£¼ë¬¸ ì·¨ì†Œ ìƒíƒœì¸ì§€( CANCEL ), ì·¨ì†Œí•œ ë§Œí¼ ì¬ê³ ê°€ ì¦ê°€í–ˆëŠ”ì§€ ê²€ì¦í•œë‹¤.

ì£¼ë¬¸ ê²€ìƒ‰ ê¸°ëŠ¥ ê°œë°œ

JPAì—ì„œ **ë™ì  ì¿¼ë¦¬**ë¥¼ ì–´ë–»ê²Œ í•´ê²°í•´ì•¼ í•˜ëŠ”ê°€?


ê²€ìƒ‰ ì¡°ê±´ íŒŒë¼ë¯¸í„° OrderSearch

```

package jpabook.jpashop.domain;
public class OrderSearch {

private String memberName;      //íšŒì›  ğŸ•”ë¦„

private OrderStatus orderStatus;//ì£¼ë¬¸  ìƒíƒœ[ORDER, CANCEL]

//Getter, Setter

}

```

**ê²€ìƒ‰ì„ ì¶”ê°€í•œ ì£¼ë¬¸ ë¦¬í¬ì§€í† ë¦¬ ì½”ë“œ**

```

package jpabook.jpashop.repository;

@Repository

public class OrderRepository {

@PersistenceContext
EntityManager em;

public void save(Order order) {
em.persist(order);

}

public Order findOne(Long id) {
return em.find(Order.class, id);

}

public List<Order> findAll(OrderSearch orderSearch) {


//... ê²€ìƒ‰  ë¡œì§

}

}

```

findAll(OrderSearch orderSearch) ë©”ì„œë“œëŠ” ê²€ìƒ‰ ì¡°ê±´ì— ë™ì ìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ìƒì„±í•´ì„œ ì£¼ë¬¸ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•œ
ë‹¤.

JPQLë¡œ ì²˜ë¦¬

```

public List<Order> findAllByString(OrderSearch orderSearch) {

//language=JPAQL

String jpql = "select o From Order o join o.member m";
boolean isFirstCondition = true;

//ì£¼ë¬¸  ìƒíƒœ  ê²€ìƒ‰

if (orderSearch.getOrderStatus() != null) {
if (isFirstCondition) {

jpql += " where";
isFirstCondition = false;

} else {

jpql += " and";

}

jpql += " o.status = :status";

}

//íšŒì›  ğŸ•”ë¦„  ê²€ìƒ‰

if (StringUtils.hasText(orderSearch.getMemberName())) {
if (isFirstCondition) {

jpql += " where";
isFirstCondition = false;

} else {

jpql += " and";

}

jpql += " m.name like :name";

}

TypedQuery<Order> query = em.createQuery(jpql, Order.class)

.setMaxResults(1000); //ìµœëŒ€  1000ê±´

if (orderSearch.getOrderStatus() != null) {

query = query.setParameter("status", orderSearch.getOrderStatus());

}

if (StringUtils.hasText(orderSearch.getMemberName())) {


query = query.setParameter("name", orderSearch.getMemberName());

}

return query.getResultList();

}

```

JPQL ì¿¼ë¦¬ë¥¼ ë¬¸ìë¡œ ìƒì„±í•˜ê¸°ëŠ” ë²ˆê±°ë¡­ê³ , ì‹¤ìˆ˜ë¡œ ì¸í•œ ë²„ê·¸ê°€ ì¶©ë¶„íˆ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

JPA Criteriaë¡œ ì²˜ë¦¬

```

public List<Order> findAllByCriteria(OrderSearch orderSearch) {

CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery<Order> cq = cb.createQuery(Order.class);
Root<Order>        o = cq.from(Order.class);

Join<Order, Member> m = o.join("member", JoinType.INNER); //íšŒì›ê³¼  ì¡°ì¸

List<Predicate> criteria = new ArrayList<>();

//ì£¼ë¬¸  ìƒíƒœ  ê²€ìƒ‰

if (orderSearch.getOrderStatus() != null) {
Predicate status = cb.equal(o.get("status"),

orderSearch.getOrderStatus());
criteria.add(status);

}

//íšŒì›  ğŸ•”ë¦„  ê²€ìƒ‰

if (StringUtils.hasText(orderSearch.getMemberName())) {
Predicate name =

cb.like(m.<String>get("name"), "%" + orderSearch.getMemberName()


+ "%");

}

criteria.add(name);

cq.where(cb.and(criteria.toArray(new Predicate[criteria.size()])));

TypedQuery<Order> query = em.createQuery(cq).setMaxResults(1000); //ìµœëŒ€  1000

ê±´

return query.getResultList();

}

```

JPA CriteriaëŠ” JPA í‘œì¤€ ìŠ¤í™ğŸ•”ì§€ë§Œ ì‹¤ë¬´ì—ì„œ ì‚¬ìš©í•˜ê¸°ì— ë„ˆë¬´ ë³µì¡í•˜ë‹¤. ê²°êµ­ ë‹¤ë¥¸ ëŒ€ì•ˆğŸ•” í•„ìš”í•˜ë‹¤. ë§ì€ ê°œë°œìê°€
ë¹„ìŠ·í•œ ê³ ë¯¼ì„ í–ˆì§€ë§Œ, ê°€ì¥ ë©‹ì§„ í•´ê²°ì±…ì€ QuerydslğŸ•” ì œì‹œí–ˆë‹¤. Querydsl ì†Œê°œì¥ì—ì„œ ê°„ë‹¨íˆ ì–¸ê¸‰í•˜ê² ë‹¤. ì§€ê¸ˆì€

ğŸ•”ëŒ€ë¡œ ì§„í–‰í•˜ì.

ì°¸ê³ : JPA Criteriaì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ ìë°” ORM í‘œì¤€ JPA í”„ë¡œê·¸ë˜ë° ì±…ì„ ì°¸ê³ í•˜ì



7. ì›¹ ê³„ì¸µ ê°œë°œ

#1.ì¸ê°•/jpaí™œìš©í¸/í™œìš©í¸1/ê°•ì˜

/í™ˆ í™”ë©´ê³¼ ë ˆğŸ•”ì•„ì›ƒ

/íšŒì› ë“±ë¡

/íšŒì› ëª©ë¡ ì¡°íšŒ

/ìƒí’ˆ ë“±ë¡

/ìƒí’ˆ ëª©ë¡

/ìƒí’ˆ ìˆ˜ì •

/ë³€ê²½ ê°ì§€ì™€ ë³‘í•©(merge)

/ìƒí’ˆ ì£¼ë¬¸

/ì£¼ë¬¸ ëª©ë¡ ê²€ìƒ‰, ì·¨ì†Œ

í™ˆ í™”ë©´ê³¼ ë ˆì´ì•„ì›ƒ

í™ˆ ì»¨íŠ¸ë¡¤ëŸ¬ ë“±ë¡

```

package jpabook.jpashop.web;

import lombok.extern.slf4j.Slf4j;

import org.springframework.stereotype.Controller;

import org.springframework.web.bind.annotation.RequestMapping;

@Controller
@Slf4j

public class HomeController {

@RequestMapping("/")
public String home() {

log.info("home controller");
return "home";

}

}

```

**ìŠ¤í”„ë§ ë¶€íŠ¸ íƒ€ì„ë¦¬í”„ ê¸°ë³¸ ì„¤ì •**

```ya

spring:
thymeleaf:

prefix: classpath:/templates/


suffix: .html

```

ìŠ¤í”„ë§ ë¶€íŠ¸ íƒ€ì„ë¦¬í”„ viewName ë§¤í•‘
resources:templates/ +{ViewName}+  .html
resources:templates/home.html

ë°˜í™˜í•œ ë¬¸ì( home )ê³¼ ìŠ¤í”„ë§ë¶€íŠ¸ ì„¤ì • prefix ,  suffix ì •ë³´ë¥¼ ì‚¬ìš©í•´ì„œ ë Œë”ë§í•  ë·°( html )ë¥¼ ì°¾ëŠ”ë‹¤.

ì°¸ê³ : https://docs.spring.io/spring-boot/docs/2.1.7.RELEASE/reference/html/common-application-
properties.html

íƒ€ì„ë¦¬í”„ í…œí”Œë¦¿ ë“±ë¡

**home.html**

```html

<!DOCTYPE HTML>

<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="fragments/header :: header">

<title>Hello</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

</head>

<body>

<div class="container">

<div th:replace="fragments/bodyHeader :: bodyHeader" />

<div class="jumbotron">

<h1>HELLO SHOP</h1>

<p class="lead">íšŒì›  ê¸°ëŠ¥</p>

<p>

<a class="btn btn-lg btn-secondary" href="/members/new">íšŒì›  ê°€ì…</a>

<a class="btn btn-lg btn-secondary" href="/members">íšŒì›  ëª©ë¡</a>

</p>

<p class="lead">ìƒí’ˆ  ê¸°ëŠ¥</p>

<p>


</p>

<a class="btn btn-lg btn-dark" href="/items/new">ìƒí’ˆ  ë“±ë¡</a>

<a class="btn btn-lg btn-dark" href="/items">ìƒí’ˆ  ëª©ë¡</a>

<p class="lead">ì£¼ë¬¸  ê¸°ëŠ¥</p>


<p>

</p>

</div>

<a class="btn btn-lg btn-info" href="/order">ìƒí’ˆ  ì£¼ë¬¸</a>

<a class="btn btn-lg btn-info" href="/orders">ì£¼ë¬¸  ë‚´ì—­</a>

<div th:replace="fragments/footer :: footer" />

</div> <!-- /container -->

</body>

</html>

```

**fragments/header.html**

```html

<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org">

<head th:fragment="header">

<!-- Required meta tags -->

<meta charset="utf-8">

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-
to-fit=no">

<!-- Bootstrap CSS -->

<link rel="stylesheet" href="/css/bootstrap.min.css" integrity="sha384-
ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
crossorigin="anonymous">

<!-- Custom styles for this template -->

<link href="/css/jumbotron-narrow.css" rel="stylesheet">

<title>Hello, world!</title>

</head>

```

**fragments/bodyHeader.html**

```html

<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org">

<div class="header" th:fragment="bodyHeader">

<ul class="nav nav-pills pull-right">

<li><a href="/">Home</a></li>

</ul>

<a href="/"><h3 class="text-muted">HELLO SHOP</h3></a>

</div>

```


**fragments/footer.html**

```html

<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org">

<div class="footer" th:fragment="footer">

<p>&copy; Hello Shop V2</p>

</div>

```

**ê²°ê³¼ í™”ë©´**

**ì°¸ê³ : Hierarchical-style layouts**

ì˜ˆì œì—ì„œëŠ” ë·° í…œí”Œë¦¿ì„ ìµœëŒ€í•œ ê°„ë‹¨í•˜ê²Œ ì„¤ëª…í•˜ë ¤ê³ ,  header ,  footer ê°™ì€ í…œí”Œë¦¿ íŒŒì¼ì„ ë°˜ë³µí•´ì„œ í¬í•¨í•œ
ë‹¤. ë‹¤ìŒ ë§í¬ì˜ Hierarchical-style layoutsì„ ì°¸ê³ í•˜ë©´ ğŸ•”ëŸ° ë¶€ë¶„ë„ ì¤‘ë³µì„ ì œê±°í•  ìˆ˜ ìˆë‹¤.
https://www.thymeleaf.org/doc/articles/layouts.html

**ì°¸ê³ : ë·° í…œí”Œë¦¿ ë³€ê²½ì‚¬í•­ì„ ì„œë²„ ì¬ì‹œì‘ ì—†ì´ ì¦‰ì‹œ ë°˜ì˜í•˜ê¸°**

1.   spring-boot-devtools ì¶”ê°€

2.   html íŒŒì¼ build-> Recompile


view ë¦¬ì†ŒìŠ¤ ë“±ë¡

ğŸ•”ìœ ë””ìì¸ì„ ìœ„í•´ ë¶€íŠ¸ìŠ¤íŠ¸ë©ì„ ì‚¬ìš©í•˜ê² ë‹¤. (v4.3.1) (https://getbootstrap.com/)

resources/static í•˜ìœ„ì— css ,  js ì¶”ê°€

resources/static/css/jumbotron-narrow.css ì¶”ê°€

**jumbotron-narrow.css íŒŒì¼**

```cs

/* Space out content a bit */
body {

padding-top: 20px;
padding-bottom: 20px;

}

/* Everything but the jumbotron gets side spacing for mobile first views */

.header,

.marketing,

.footer {

padding-left: 15px;
padding-right: 15px;

}

/* Custom page header */

.header {

border-bottom: 1px solid #e5e5e5;

}

/* Make the masthead heading the same height as the navigation */

.header h3 {
margin-top: 0;

margin-bottom: 0;
line-height: 40px;
padding-bottom: 19px;

}

/* Custom page footer */

.footer {

padding-top: 19px;
color: #777;

border-top: 1px solid #e5e5e5;


}

/* Customize container */
@media (min-width: 768px) {

.container {

max-width: 730px;

}

}

.container-narrow > hr {
margin: 30px 0;

}

/* Main marketing message and sign up button */

.jumbotron {

text-align: center;

border-bottom: 1px solid #e5e5e5;

}

.jumbotron .btn {
font-size: 21px;
padding: 14px 24px;

}

/* Supporting marketing content */

.marketing {
margin: 40px 0;

}

.marketing p + h4 {
margin-top: 28px;

}

/* Responsive: Portrait tablets and up */
@media screen and (min-width: 768px) {

/* Remove the padding we set earlier */

.header,

.marketing,

.footer {

padding-left: 0;

padding-right: 0;

}

/* Space out the masthead */

.header {

margin-bottom: 30px;

}


/* Remove the bottom border on the jumbotron for visual effect */

.jumbotron {

border-bottom: 0;

}

}

```

íšŒì› ë“±ë¡

í¼ ê°ì²´ë¥¼ ì‚¬ìš©í•´ì„œ í™”ë©´ ê³„ì¸µê³¼ ì„œë¹„ìŠ¤ ê³„ì¸µì„ ëª…í™•í•˜ê²Œ ë¶„ë¦¬í•œë‹¤.

**íšŒì› ë“±ë¡ í¼ ê°ì²´

```

package jpabook.jpashop.web;

import lombok.Getter;
import lombok.Setter;

import javax.validation.constraints.NotEmpty;

@Getter @Setter

public class MemberForm {

@NotEmpty(message = "íšŒì›  ğŸ•”ë¦„ì€  í•„ìˆ˜  ì…ë‹ˆë‹¤")
private String name;

private String city;
private String street;
private String zipcode;

}

```

**íšŒì› ë“±ë¡ ì»¨íŠ¸ë¡¤ëŸ¬**

```

package jpabook.jpashop.web;

import jpabook.jpashop.domain.Address;
import jpabook.jpashop.domain.Member;

import jpabook.jpashop.service.MemberService;
import lombok.RequiredArgsConstructor;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;

import org.springframework.validation.BindingResult;

import org.springframework.web.bind.annotation.RequestMapping;


import org.springframework.web.bind.annotation.RequestMethod;

import javax.validation.Valid;
import java.util.List;

@Controller
@RequiredArgsConstructor

public class MemberController {

private final MemberService memberService;
@GetMapping(value = "/members/new")

public String createForm(Model model) {
model.addAttribute("memberForm", new MemberForm());
return "members/createMemberForm";

}

@PostMapping(value = "/members/new")

public String create(@Valid MemberForm form, BindingResult result) {

if (result.hasErrors()) {

return "members/createMemberForm";

}

Address address = new Address(form.getCity(), form.getStreet(),
form.getZipcode());

Member member = new Member();
member.setName(form.getName());
member.setAddress(address);

memberService.join(member);

return "redirect:/";

}

}

```

íšŒì› ë“±ë¡ í¼ í™”ë©´( templates/members/createMemberForm.html )

```html

<!DOCTYPE HTML>

<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="fragments/header :: header" />

<style>

.fieldError {


border-color: #bd2130;

}

</style>

<body>

<div class="container">

<div th:replace="fragments/bodyHeader :: bodyHeader"/>

<form role="form" action="/members/new" th:object="${memberForm}"
method="post">

<div class="form-group">

<label th:for="name">ğŸ•”ë¦„</label>

<input type="text" th:field="*{name}" class="form-control"
placeholder="ğŸ•”ë¦„ì„  ì…ë ¥í•˜ì„¸ìš”"

th:class="${#fields.hasErrors('name')}? 'form-control
fieldError' : 'form-control'">

<p th:if="${#fields.hasErrors('name')}"
th:errors="*{name}">Incorrect date</p>

</div>

<div class="form-group">

<label th:for="city">ë„ì‹œ</label>

<input type="text" th:field="*{city}" class="form-control"
placeholder="ë„ì‹œë¥¼  ì…ë ¥í•˜ì„¸ìš”">

</div>

<div class="form-group">

<label th:for="street">ê±°ë¦¬</label>

<input type="text" th:field="*{street}" class="form-control"
placeholder="ê±°ë¦¬ë¥¼  ì…ë ¥í•˜ì„¸ìš”">

</div>

<div class="form-group">

<label th:for="zipcode">ìš°í¸ë²ˆí˜¸</label>

<input type="text" th:field="*{zipcode}" class="form-control"
placeholder="ìš°í¸ë²ˆí˜¸ë¥¼  ì…ë ¥í•˜ì„¸ìš”">

</div>

<button type="submit" class="btn btn-primary">Submit</button>

</form>

<br/>

<div th:replace="fragments/footer :: footer" />

</div> <!-- /container -->

</body>

</html>

```


íšŒì› ëª©ë¡ ì¡°íšŒ

**íšŒì› ëª©ë¡ ì»¨íŠ¸ë¡¤ëŸ¬ ì¶”ê°€**

```

package jpabook.jpashop.web;

@Controller
@RequiredArgsConstructor

public class MemberController {

//ì¶”ê°€

@GetMapping(value = "/members")
public String list(Model model) {

List<Member> members = memberService.findMembers();
model.addAttribute("members", members);

return "members/memberList";

}

}

```

ì¡°íšŒí•œ ìƒí’ˆì„ ë·°ì— ì „ë‹¬í•˜ê¸° ìœ„í•´ ìŠ¤í”„ë§ MVCê°€ ì œê³µí•˜ëŠ” ëª¨ë¸( Model ) ê°ì²´ì— ë³´ê´€
ì‹¤í–‰í•  ë·° ğŸ•”ë¦„ì„ ë°˜í™˜

íšŒì› ëª©ë¡ ë·°( templates/members/memberList.html )

```html

<!DOCTYPE HTML>

<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="fragments/header :: header" />

<body>

<div class="container">

<div th:replace="fragments/bodyHeader :: bodyHeader" />

<div>

<table class="table table-striped">

<thead>

<tr>

<th>#</th>

<th>ğŸ•”ë¦„</th>

<th>ë„ì‹œ</th>

<th>ì£¼ì†Œ</th>


<th>ìš°í¸ë²ˆí˜¸</th>

</tr>

</thead>

<tbody>

<tr th:each="member : ${members}">

<td th:text="${member.id}"></td>

<td th:text="${member.name}"></td>

<td th:text="${member.address?.city}"></td>

<td th:text="${member.address?.street}"></td>

<td th:text="${member.address?.zipcode}"></td>

</tr>

</tbody>

</table>

</div>

<div th:replace="fragments/footer :: footer" />

</div> <!-- /container -->

</body>

</html>

```

ì°¸ê³ : íƒ€ì„ë¦¬í”„ì—ì„œ ?ë¥¼ ì‚¬ìš©í•˜ë©´ null ì„ ë¬´ì‹œí•œë‹¤.
ì°¸ê³ : í¼ ê°ì²´ vs ì—”í‹°í‹° ì§ì ‘ ì‚¬ìš©

ì°¸ê³ : ìš”êµ¬ì‚¬í•­ğŸ•” ì •ë§ ë‹¨ìˆœí•  ë•ŒëŠ” í¼ ê°ì²´( MemberForm ) ì—†ğŸ•” ì—”í‹°í‹°( Member )ë¥¼ ì§ì ‘ ë“±ë¡ê³¼ ìˆ˜ì • í™”ë©´ì—
ì„œ ì‚¬ìš©í•´ë„ ëœë‹¤. í•˜ì§€ë§Œ í™”ë©´ ìš”êµ¬ì‚¬í•­ğŸ•” ë³µì¡í•´ì§€ê¸° ì‹œì‘í•˜ë©´, ì—”í‹°í‹°ì— í™”ë©´ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ ê¸°ëŠ¥ğŸ•” ì ì  ì¦
ê°€í•œë‹¤. ê²°ê³¼ì ìœ¼ë¡œ ì—”í‹°í‹°ëŠ” ì ì  í™”ë©´ì— ì¢…ì†ì ìœ¼ë¡œ ë³€í•˜ê³ , ğŸ•”ë ‡ê²Œ í™”ë©´ ê¸°ëŠ¥ ë•Œë¬¸ì— ì§€ì €ë¶„í•´ì§„ ì—”í‹°í‹°ëŠ” ê²°
êµ­ ìœ ì§€ë³´ìˆ˜í•˜ê¸° ì–´ë ¤ì›Œì§„ë‹¤.

ì‹¤ë¬´ì—ì„œ **ì—”í‹°í‹°ëŠ” í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ë§Œ ê°€ì§€ê³  ìˆê³ , í™”ë©´ì„ ìœ„í•œ ë¡œì§ì€ ì—†ì–´ì•¼ í•œë‹¤**. í™”ë©´ğŸ•”ë‚˜ APIì— ë§ëŠ” í¼
ê°ì²´ë‚˜ DTOë¥¼ ì‚¬ìš©í•˜ì. ê·¸ë˜ì„œ í™”ë©´ğŸ•”ë‚˜ API ìš”êµ¬ì‚¬í•­ì„ ğŸ•”ê²ƒë“¤ë¡œ ì²˜ë¦¬í•˜ê³ , ì—”í‹°í‹°ëŠ” ìµœëŒ€í•œ ìˆœìˆ˜í•˜ê²Œ ìœ ì§€
í•˜ì.

ìƒí’ˆ ë“±ë¡

**ìƒí’ˆ ë“±ë¡ í¼**

```

package jpabook.jpashop.web;

import lombok.Getter;
import lombok.Setter;


@Getter @Setter

public class BookForm {
private Long id;

private String name;
private int price;

private int stockQuantity;

private String author;
private String isbn;

}

```

**ìƒí’ˆ ë“±ë¡ ì»¨íŠ¸ë¡¤ëŸ¬**

```

package jpabook.jpashop.web;

import jpabook.jpashop.domain.item.Book;
import jpabook.jpashop.domain.item.Item;
import jpabook.jpashop.service.ItemService;
import lombok.RequiredArgsConstructor;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;

import org.springframework.web.bind.annotation.*;
import java.util.List;

@Controller
@RequiredArgsConstructor
public                          class ItemController {

private final ItemService itemService;

@GetMapping(value = "/items/new")
public String createForm(Model model) {

model.addAttribute("form", new BookForm());
return "items/createItemForm";

}

@PostMapping(value = "/items/new")
public String create(BookForm form) {


Book book = new Book();
book.setName(form.getName());
book.setPrice(form.getPrice());
book.setStockQuantity(form.getStockQuantity());
book.setAuthor(form.getAuthor());
book.setIsbn(form.getIsbn());

itemService.saveItem(book);
return "redirect:/items";

}

}

```

ìƒí’ˆ ë“±ë¡ ë·°( items/createItemForm.html )

```html

<!DOCTYPE HTML>

<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="fragments/header :: header" />

<body>

<div class="container">

<div th:replace="fragments/bodyHeader :: bodyHeader"/>

<form th:action="@{/items/new}" th:object="${form}" method="post">

<div class="form-group">

<label th:for="name">ìƒí’ˆëª…</label>

<input type="text" th:field="*{name}" class="form-control"
placeholder="ğŸ•”ë¦„ì„  ì…ë ¥í•˜ì„¸ìš”">

</div>

<div class="form-group">

<label th:for="price">ê°€ê²©</label>

<input type="number" th:field="*{price}" class="form-control"
placeholder="ê°€ê²©ì„  ì…ë ¥í•˜ì„¸ìš”">

</div>

<div class="form-group">

<label th:for="stockQuantity">ìˆ˜ëŸ‰</label>

<input type="number" th:field="*{stockQuantity}" class="form-
control" placeholder="ìˆ˜ëŸ‰ì„  ì…ë ¥í•˜ì„¸ìš”">

</div>

<div class="form-group">

<label th:for="author">ì €ì</label>

<input type="text" th:field="*{author}" class="form-control"
placeholder="ì €ìë¥¼  ì…ë ¥í•˜ì„¸ìš”">


</div>

<div class="form-group">

<label th:for="isbn">ISBN</label>

<input type="text" th:field="*{isbn}" class="form-control"
placeholder="ISBNì„  ì…ë ¥í•˜ì„¸ìš”">

</div>

<button type="submit" class="btn btn-primary">Submit</button>

</form>

<br/>

<div th:replace="fragments/footer :: footer" />

</div> <!-- /container -->

</body>

</html>

```

ì£¼ì˜: PDFì—ì„œ html íŒŒì¼ì„ ë³µì‚¬í•  ë•Œ ì¤„ë°”ê¿ˆ ë•Œë¬¸ì—,   form-control ğŸ•”  formcontrol ğŸ•”ë¼ê³  ë¶™ëŠ” ê²½ìš°
ê°€ ìˆë‹¤. ğŸ•” ê²½ìš° form-control ë¡œ ìˆ˜ì •í•´ì•¼ í•œë‹¤.

**ìƒí’ˆ ë“±ë¡**

ìƒí’ˆ ë“±ë¡ í¼ì—ì„œ ë°ğŸ•”í„°ë¥¼ ì…ë ¥í•˜ê³  Submit ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ /items/new ë¥¼ POST ë°©ì‹ìœ¼ë¡œ ìš”ì²­
ìƒí’ˆ ì €ì¥ğŸ•” ëë‚˜ë©´ ìƒí’ˆ ëª©ë¡ í™”ë©´( redirect:/items )ìœ¼ë¡œ ë¦¬ë‹¤ğŸ•”ë ‰íŠ¸

ìƒí’ˆ ëª©ë¡

**ìƒí’ˆ ëª©ë¡ ì»¨íŠ¸ë¡¤ëŸ¬**

```

package jpabook.jpashop.web;

@Controller
@RequiredArgsConstructor
public                          class ItemController {

private final ItemService itemService;

/**

* ìƒí’ˆ  ëª©ë¡

*/

@GetMapping(value = "/items")
public String list(Model model) {


List<Item> items = itemService.findItems();
model.addAttribute("items", items);

return "items/itemList";

}

}

```

ìƒí’ˆ ëª©ë¡ ë·°( items/itemList.html )

```html

<!DOCTYPE HTML>

<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="fragments/header :: header" />

<body>

<div class="container">

<div th:replace="fragments/bodyHeader :: bodyHeader"/>

<div>

<table class="table table-striped">

<thead>

<tr>

<th>#</th>

<th>ìƒí’ˆëª…</th>

<th>ê°€ê²©</th>

<th>ì¬ê³ ìˆ˜ëŸ‰</th>

<th></th>

</tr>

</thead>

<tbody>

<tr th:each="item : ${items}">

<td th:text="${item.id}"></td>

<td th:text="${item.name}"></td>

<td th:text="${item.price}"></td>

<td th:text="${item.stockQuantity}"></td>

<td>

<a href="#" th:href="@{/items/{id}/edit (id=${item.id})}"
class="btn btn-primary" role="button">ìˆ˜ì •</a>

</td>

</tr>

</tbody>

</table>

</div>


<div th:replace="fragments/footer :: footer"/>

</div> <!-- /container -->

</body>

</html>

```

model ì— ë‹´ì•„ë‘” ìƒí’ˆ ëª©ë¡ì¸ items ë¥¼ êº¼ë‚´ì„œ ìƒí’ˆ ì •ë³´ë¥¼ ì¶œë ¥

ìƒí’ˆ ìˆ˜ì •

**ìƒí’ˆ ìˆ˜ì •ê³¼ ê´€ë ¨ëœ ì»¨íŠ¸ë¡¤ëŸ¬ ì½”ë“œ**

```

package jpabook.jpashop.web;

import jpabook.jpashop.domain.item.Book;
import jpabook.jpashop.domain.item.Item;
import jpabook.jpashop.service.ItemService;
import lombok.RequiredArgsConstructor;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;

import org.springframework.web.bind.annotation.*;
import java.util.List;

@Controller
@RequiredArgsConstructor
public                          class ItemController {

/**

* ìƒí’ˆ  ìˆ˜ì •  í¼

*/

@GetMapping(value = "/items/{itemId}/edit")

public String updateItemForm(@PathVariable("itemId") Long itemId, Model
model) {

Book item = (Book) itemService.findOne(itemId);
BookForm form = new BookForm();


form.setId(item.getId());
form.setName(item.getName());
form.setPrice(item.getPrice());
form.setStockQuantity(item.getStockQuantity());
form.setAuthor(item.getAuthor());
form.setIsbn(item.getIsbn());

model.addAttribute("form", form);
return "items/updateItemForm";

}

/**

* ìƒí’ˆ  ìˆ˜ì •

*/

@PostMapping(value = "/items/{itemId}/edit")

public String updateItem(@ModelAttribute("form") BookForm form) {

Book book = new Book();
book.setId(form.getId());
book.setName(form.getName());
book.setPrice(form.getPrice());
book.setStockQuantity(form.getStockQuantity());
book.setAuthor(form.getAuthor());
book.setIsbn(form.getIsbn());

itemService.saveItem(book);
return "redirect:/items";

}

}

```

ìƒí’ˆ ìˆ˜ì • í¼ í™”ë©´( items/updateItemForm )

```html

<!DOCTYPE HTML>

<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="fragments/header :: header" />

<body>

<div class="container">

<div th:replace="fragments/bodyHeader :: bodyHeader"/>

<form th:object="${form}" method="post">

<!-- id -->


<input type="hidden" th:field="*{id}" />

<div class="form-group">

<label th:for="name">ìƒí’ˆëª…</label>

<input type="text" th:field="*{name}" class="form-control"
placeholder="ğŸ•”ë¦„ì„  ì…ë ¥í•˜ì„¸ìš”" />

</div>

<div class="form-group">

<label th:for="price">ê°€ê²©</label>

<input type="number" th:field="*{price}" class="form-control"
placeholder="ê°€ê²©ì„  ì…ë ¥í•˜ì„¸ìš”" />

</div>

<div class="form-group">

<label th:for="stockQuantity">ìˆ˜ëŸ‰</label>

<input type="number" th:field="*{stockQuantity}" class="form-
control" placeholder="ìˆ˜ëŸ‰ì„  ì…ë ¥í•˜ì„¸ìš”" />

</div>

<div class="form-group">

<label th:for="author">ì €ì</label>

<input type="text" th:field="*{author}" class="form-control"
placeholder="ì €ìë¥¼  ì…ë ¥í•˜ì„¸ìš”" />

</div>

<div class="form-group">

<label th:for="isbn">ISBN</label>

<input type="text" th:field="*{isbn}" class="form-control"
placeholder="ISBNì„  ì…ë ¥í•˜ì„¸ìš”" />

</div>

<button type="submit" class="btn btn-primary">Submit</button>

</form>

<div th:replace="fragments/footer :: footer" />

</div> <!-- /container -->

</body>

</html>

```

ìƒí’ˆ ìˆ˜ì • í¼ ì´ë™

1.   ìˆ˜ì • ë²„íŠ¼ì„ ì„ íƒí•˜ë©´ /items/{itemId}/edit URLì„ GET ë°©ì‹ìœ¼ë¡œ ìš”ì²­

2.   ê·¸ ê²°ê³¼ë¡œ updateItemForm() ë©”ì„œë“œë¥¼ ì‹¤í–‰í•˜ëŠ”ë° ğŸ•” ë©”ì„œë“œëŠ” itemService.findOne(itemId) ë¥¼
í˜¸ì¶œí•´ì„œ ìˆ˜ì •í•  ìƒí’ˆì„ ì¡°íšŒ


3.   ì¡°íšŒ ê²°ê³¼ë¥¼ ëª¨ë¸ ê°ì²´ì— ë‹´ì•„ì„œ ë·°( items/updateItemForm )ì— ì „ë‹¬

ìƒí’ˆ ìˆ˜ì • ì‹¤í–‰

ìƒí’ˆ ìˆ˜ì • í¼ HTMLì—ëŠ” ìƒí’ˆì˜ id(hidden), ìƒí’ˆëª…, ê°€ê²©, ìˆ˜ëŸ‰ ì •ë³´ ìˆìŒ

1.   ìƒí’ˆ ìˆ˜ì • í¼ì—ì„œ ì •ë³´ë¥¼ ìˆ˜ì •í•˜ê³  Submit ë²„íŠ¼ì„ ì„ íƒ

2.    /items/{itemId}/edit URLì„ POST ë°©ì‹ìœ¼ë¡œ ìš”ì²­í•˜ê³  updateItem() ë©”ì„œë“œë¥¼ ì‹¤í–‰

3.   ğŸ•”ë•Œ ì»¨íŠ¸ë¡¤ëŸ¬ì— íŒŒë¼ë¯¸í„°ë¡œ ë„˜ì–´ì˜¨ item ì—”í‹°í‹° ì¸ìŠ¤í„´ìŠ¤ëŠ” í˜„ì¬ ì¤€ì˜ì† ìƒíƒœë‹¤. ë”°ë¼ì„œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ì§€
ì›ì„ ë°›ì„ ìˆ˜ ì—†ê³  ë°ğŸ•”í„°ë¥¼ ìˆ˜ì •í•´ë„ ë³€ê²½ ê°ì§€ ê¸°ëŠ¥ì€ ë™ì‘X

ë³€ê²½ ê°ì§€ì™€ ë³‘í•©(merge)

ì°¸ê³ : ì •ë§ ì¤‘ìš”í•œ ë‚´ìš©ğŸ•”ë‹ˆ ê¼­! ì™„ë²½í•˜ê²Œ ğŸ•”í•´í•˜ì…”ì•¼ í•©ë‹ˆë‹¤.

**ì¤€ì˜ì† ì—”í‹°í‹°?**

ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ë”ëŠ” ê´€ë¦¬í•˜ì§€ ì•ŠëŠ” ì—”í‹°í‹°ë¥¼ ë§í•œë‹¤.

(ì—¬ê¸°ì„œëŠ” itemService.saveItem(book) ì—ì„œ ìˆ˜ì •ì„ ì‹œë„í•˜ëŠ” Book ê°ì²´ë‹¤.  Book ê°ì²´ëŠ” ğŸ•”ë¯¸ DBì— í•œë²ˆ
ì €ì¥ë˜ì–´ì„œ ì‹ë³„ìê°€ ì¡´ì¬í•œë‹¤. ğŸ•”ë ‡ê²Œ ì„ì˜ë¡œ ë§Œë“¤ì–´ë‚¸ ì—”í‹°í‹°ë„ ê¸°ì¡´ ì‹ë³„ìë¥¼ ê°€ì§€ê³  ìˆìœ¼ë©´ ì¤€ì˜ì† ì—”í‹°í‹°ë¡œ ë³¼ ìˆ˜
ìˆë‹¤.)

**ì¤€ì˜ì† ì—”í‹°í‹°ë¥¼ ìˆ˜ì •í•˜ëŠ” 2ê°€ì§€ ë°©ë²•**

ë³€ê²½ ê°ì§€ ê¸°ëŠ¥ ì‚¬ìš©
ë³‘í•©( merge ) ì‚¬ìš©

ë³€ê²½ ê°ì§€ ê¸°ëŠ¥ ì‚¬ìš©

```

@Transactional

void update(Item itemParam) { //itemParam: íŒŒë¦¬ë¯¸í„°ë¡œ  ë„˜ì–´ì˜¨  ì¤€ì˜ì†  ìƒíƒœì˜  ì—”í‹°í‹°

Item findItem = em.find(Item.class, itemParam.getId()); //ê°™ì€  ì—”í‹°í‹°ë¥¼  ì¡°íšŒí•œë‹¤.
findItem.setPrice(itemParam.getPrice()); //ë°ğŸ•”í„°ë¥¼  ìˆ˜ì •í•œë‹¤.

}

```

ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì—”í‹°í‹°ë¥¼ ë‹¤ì‹œ ì¡°íšŒí•œ í›„ì— ë°ğŸ•”í„°ë¥¼ ìˆ˜ì •í•˜ëŠ” ë°©ë²•

íŠ¸ëœì­ì…˜ ì•ˆì—ì„œ ì—”í‹°í‹°ë¥¼ ë‹¤ì‹œ ì¡°íšŒ, ë³€ê²½í•  ê°’ ì„ íƒ    íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œì ì— ë³€ê²½ ê°ì§€(Dirty Checking)ğŸ•” ë™ì‘í•´ì„œ
ë°ğŸ•”í„°ë² ğŸ•”ìŠ¤ì— UPDATE SQL ì‹¤í–‰


ë³‘í•© ì‚¬ìš©

ë³‘í•©ì€ ì¤€ì˜ì† ìƒíƒœì˜ ì—”í‹°í‹°ë¥¼ ì˜ì† ìƒíƒœë¡œ ë³€ê²½í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥ğŸ•”ë‹¤.

```

@Transactional

void update(Item itemParam) { //itemParam: íŒŒë¦¬ë¯¸í„°ë¡œ  ë„˜ì–´ì˜¨  ì¤€ì˜ì†  ìƒíƒœì˜  ì—”í‹°í‹°

Item mergeItem = em.merge(itemParam);

}

```

**ë³‘í•©: ê¸°ì¡´ì— ìˆëŠ” ì—”í‹°í‹°**

**ë³‘í•© ë™ì‘ ë°©ì‹**

1.    merge() ë¥¼ ì‹¤í–‰í•œë‹¤.

2.   íŒŒë¼ë¯¸í„°ë¡œ ë„˜ì–´ì˜¨ ì¤€ì˜ì† ì—”í‹°í‹°ì˜ ì‹ë³„ì ê°’ìœ¼ë¡œ 1ì°¨ ìºì‹œì—ì„œ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•œë‹¤.

2-1. ë§Œì•½ 1ì°¨ ìºì‹œì— ì—”í‹°í‹°ê°€ ì—†ìœ¼ë©´ ë°ğŸ•”í„°ë² ğŸ•”ìŠ¤ì—ì„œ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•˜ê³ , 1ì°¨ ìºì‹œì— ì €ì¥í•œë‹¤.

3.   ì¡°íšŒí•œ ì˜ì† ì—”í‹°í‹°( mergeMember )ì— member ì—”í‹°í‹°ì˜ ê°’ì„ ì±„ì›Œ ë„£ëŠ”ë‹¤. (member ì—”í‹°í‹°ì˜ ëª¨ë“  ê°’ì„

mergeMemberì— ë°€ì–´ ë„£ëŠ”ë‹¤. ğŸ•”ë•Œ mergeMemberì˜ â€œíšŒì›1â€ğŸ•”ë¼ëŠ” ğŸ•”ë¦„ğŸ•” â€œíšŒì›ëª…ë³€ê²½â€ìœ¼ë¡œ ë°”ë€ë‹¤.)

4.   ì˜ì† ìƒíƒœì¸ mergeMemberë¥¼ ë°˜í™˜í•œë‹¤.

ì°¸ê³ : ì±… ìë°” ORM í‘œì¤€ JPA í”„ë¡œê·¸ë˜ë° 3.6.5

**ë³‘í•©ì‹œ ë™ì‘ ë°©ì‹ì„ ê°„ë‹¨íˆ ì •ë¦¬**

1.   ì¤€ì˜ì† ì—”í‹°í‹°ì˜ ì‹ë³„ì ê°’ìœ¼ë¡œ ì˜ì† ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•œë‹¤.

2.   ì˜ì† ì—”í‹°í‹°ì˜ ê°’ì„ ì¤€ì˜ì† ì—”í‹°í‹°ì˜ ê°’ìœ¼ë¡œ ëª¨ë‘ êµì²´í•œë‹¤.(ë³‘í•©í•œë‹¤.)


3.   íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œì ì— ë³€ê²½ ê°ì§€ ê¸°ëŠ¥ğŸ•” ë™ì‘í•´ì„œ ë°ğŸ•”í„°ë² ğŸ•”ìŠ¤ì— UPDATE SQLğŸ•” ì‹¤í–‰

ì£¼ì˜: ë³€ê²½ ê°ì§€ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë©´ ì›í•˜ëŠ” ì†ì„±ë§Œ ì„ íƒí•´ì„œ ë³€ê²½í•  ìˆ˜ ìˆì§€ë§Œ, ë³‘í•©ì„ ì‚¬ìš©í•˜ë©´ ëª¨ë“  ì†ì„±ğŸ•” ë³€ê²½ëœ
ë‹¤. ë³‘í•©ì‹œ ê°’ğŸ•” ì—†ìœ¼ë©´ null ë¡œ ì—…ë°ğŸ•”íŠ¸ í•  ìœ„í—˜ë„ ìˆë‹¤. (ë³‘í•©ì€ ëª¨ë“  í•„ë“œë¥¼ êµì²´í•œë‹¤.)

ìƒí’ˆ ë¦¬í¬ì§€í† ë¦¬ì˜ ì €ì¥ ë©”ì„œë“œ ë¶„ì„ ItemRepository

```

package jpabook.jpashop.repository;

@Repository

public class ItemRepository {

@PersistenceContext
EntityManager em;

public void save(Item item) {
if (item.getId() == null) {

em.persist(item);

} else {

em.merge(item);

}

}


}

```

//...

save() ë©”ì„œë“œëŠ” ì‹ë³„ì ê°’ğŸ•” ì—†ìœ¼ë©´( null ) ìƒˆë¡œìš´ ì—”í‹°í‹°ë¡œ íŒë‹¨í•´ì„œ ì˜ì†í™”(persist)í•˜ê³  ì‹ë³„ìê°€ ìˆìœ¼
ë©´ ë³‘í•©(merge)

ì§€ê¸ˆì²˜ëŸ¼ ì¤€ì˜ì† ìƒíƒœì¸ ìƒí’ˆ ì—”í‹°í‹°ë¥¼ ìˆ˜ì •í•  ë•ŒëŠ” id ê°’ğŸ•” ìˆìœ¼ë¯€ë¡œ ë³‘í•© ìˆ˜í–‰

**ìƒˆë¡œìš´ ì—”í‹°í‹° ì €ì¥ê³¼ ì¤€ì˜ì† ì—”í‹°í‹° ë³‘í•©ì„ í¸ë¦¬í•˜ê²Œ í•œë²ˆì— ì²˜ë¦¬**

ìƒí’ˆ ë¦¬í¬ì§€í† ë¦¬ì—ì„  save() ë©”ì„œë“œë¥¼ ìœ ì‹¬íˆ ë´ì•¼ í•˜ëŠ”ë°, ğŸ•” ë©”ì„œë“œ í•˜ë‚˜ë¡œ ì €ì¥ê³¼ ìˆ˜ì •(ë³‘í•©)ì„ ë‹¤ ì²˜ë¦¬í•œë‹¤. ì½”ë“œ
ë¥¼ ë³´ë©´ ì‹ë³„ì ê°’ğŸ•” ì—†ìœ¼ë©´ ìƒˆë¡œìš´ ì—”í‹°í‹°ë¡œ íŒë‹¨í•´ì„œ persist() ë¡œ ì˜ì†í™”í•˜ê³  ë§Œì•½ ì‹ë³„ì ê°’ğŸ•” ìˆìœ¼ë©´ ğŸ•”ë¯¸ í•œë²ˆ
ì˜ì†í™” ë˜ì—ˆë˜ ì—”í‹°í‹°ë¡œ íŒë‹¨í•´ì„œ merge() ë¡œ ìˆ˜ì •(ë³‘í•©)í•œë‹¤. ê²°êµ­ ì—¬ê¸°ì„œì˜ ì €ì¥(save)ğŸ•”ë¼ëŠ” ì˜ë¯¸ëŠ” ì‹ ê·œ ë°ğŸ•”í„°
ë¥¼ ì €ì¥í•˜ëŠ” ê²ƒë¿ë§Œ ì•„ë‹ˆë¼ ë³€ê²½ëœ ë°ğŸ•”í„°ì˜ ì €ì¥ğŸ•”ë¼ëŠ” ì˜ë¯¸ë„ í¬í•¨í•œë‹¤. ğŸ•”ë ‡ê²Œ í•¨ìœ¼ë¡œì¨ ğŸ•” ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ëŠ” í´ë¼

ğŸ•”ì–¸íŠ¸ëŠ” ì €ì¥ê³¼ ìˆ˜ì •ì„ êµ¬ë¶„í•˜ì§€ ì•Šì•„ë„ ë˜ë¯€ë¡œ í´ë¼ğŸ•”ì–¸íŠ¸ì˜ ë¡œì§ğŸ•” ë‹¨ìˆœí•´ì§„ë‹¤.

ì—¬ê¸°ì„œ ì‚¬ìš©í•˜ëŠ” ìˆ˜ì •(ë³‘í•©)ì€ ì¤€ì˜ì† ìƒíƒœì˜ ì—”í‹°í‹°ë¥¼ ìˆ˜ì •í•  ë•Œ ì‚¬ìš©í•œë‹¤. ì˜ì† ìƒíƒœì˜ ì—”í‹°í‹°ëŠ” ë³€ê²½ ê°ì§€(dirty
checking)ê¸°ëŠ¥ğŸ•” ë™ì‘í•´ì„œ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•  ë•Œ ìë™ìœ¼ë¡œ ìˆ˜ì •ë˜ë¯€ë¡œ ë³„ë„ì˜ ìˆ˜ì • ë©”ì„œë“œë¥¼ í˜¸ì¶œí•  í•„ìš”ê°€ ì—†ê³  ê·¸ëŸ°
ë©”ì„œë“œë„ ì—†ë‹¤.


~~                                                                                                  
                                                                                                    
                                                                                                    
                                                                                                    
                                                                    ~~

ì°¸ê³ :  save() ë©”ì„œë“œëŠ” ì‹ë³„ìë¥¼ ìë™ ìƒì„±í•´ì•¼ ì •ìƒ ë™ì‘í•œë‹¤. ì—¬ê¸°ì„œ ì‚¬ìš©í•œ Item ì—”í‹°í‹°ì˜ ì‹ë³„ìëŠ” ìë™
ìœ¼ë¡œ ìƒì„±ë˜ë„ë¡ @GeneratedValue ë¥¼ ì„ ì–¸í–ˆë‹¤. ë”°ë¼ì„œ ì‹ë³„ì ì—†ğŸ•” save() ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´
persist() ê°€ í˜¸ì¶œë˜ë©´ì„œ ì‹ë³„ì ê°’ğŸ•” ìë™ìœ¼ë¡œ í• ë‹¹ëœë‹¤. ë°˜ë©´ì— ì‹ë³„ìë¥¼ ì§ì ‘ í• ë‹¹í•˜ë„ë¡ @Id ë§Œ ì„ ì–¸í–ˆë‹¤
ê³  ê°€ì •í•˜ì. ğŸ•” ê²½ìš° ì‹ë³„ìë¥¼ ì§ì ‘ í• ë‹¹í•˜ì§€ ì•Šê³ ,  save() ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´ ì‹ë³„ìê°€ ì—†ëŠ” ìƒíƒœë¡œ
persist() ë¥¼ í˜¸ì¶œí•œë‹¤. ê·¸ëŸ¬ë©´ ì‹ë³„ìê°€ ì—†ë‹¤ëŠ” ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤.

ì°¸ê³ : ì‹¤ë¬´ì—ì„œëŠ” ë³´í†µ ì—…ë°ğŸ•”íŠ¸ ê¸°ëŠ¥ğŸ•” ë§¤ìš° ì œí•œì ğŸ•”ë‹¤. ê·¸ëŸ°ë° ë³‘í•©ì€ ëª¨ë“  í•„ë“œë¥¼ ë³€ê²½í•´ë²„ë¦¬ê³ , ë°ğŸ•”í„°ê°€ ì—†
ìœ¼ë©´ null ë¡œ ì—…ë°ğŸ•”íŠ¸ í•´ë²„ë¦°ë‹¤. ë³‘í•©ì„ ì‚¬ìš©í•˜ë©´ì„œ ğŸ•” ë¬¸ì œë¥¼ í•´ê²°í•˜ë ¤ë©´, ë³€ê²½ í¼ í™”ë©´ì—ì„œ ëª¨ë“  ë°ğŸ•”í„°ë¥¼ í•­
ìƒ ìœ ì§€í•´ì•¼ í•œë‹¤. ì‹¤ë¬´ì—ì„œëŠ” ë³´í†µ ë³€ê²½ê°€ëŠ¥í•œ ë°ğŸ•”í„°ë§Œ ë…¸ì¶œí•˜ê¸° ë•Œë¬¸ì—, ë³‘í•©ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒğŸ•” ì˜¤íˆë ¤ ë²ˆê±°ë¡­
ë‹¤.

ê°€ì¥ ì¢‹ì€ í•´ê²° ë°©ë²•

**ì—”í‹°í‹°ë¥¼ ë³€ê²½í•  ë•ŒëŠ” í•­ìƒ ë³€ê²½ ê°ì§€ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”**

ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì–´ì„¤í”„ê²Œ ì—”í‹°í‹°ë¥¼ ìƒì„±í•˜ì§€ ë§ˆì„¸ìš”.

íŠ¸ëœì­ì…˜ğŸ•” ìˆëŠ” ì„œë¹„ìŠ¤ ê³„ì¸µì— ì‹ë³„ì( id )ì™€ ë³€ê²½í•  ë°ğŸ•”í„°ë¥¼ ëª…í™•í•˜ê²Œ ì „ë‹¬í•˜ì„¸ìš”.(íŒŒë¼ë¯¸í„° or dto)
íŠ¸ëœì­ì…˜ğŸ•” ìˆëŠ” ì„œë¹„ìŠ¤ ê³„ì¸µì—ì„œ ì˜ì† ìƒíƒœì˜ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•˜ê³ , ì—”í‹°í‹°ì˜ ë°ğŸ•”í„°ë¥¼ ì§ì ‘ ë³€ê²½í•˜ì„¸ìš”.
íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œì ì— ë³€ê²½ ê°ì§€ê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.

```

@Controller
@RequiredArgsConstructor
public                          class ItemController {

private final ItemService itemService;

/**

* ìƒí’ˆ  ìˆ˜ì •, ê¶Œì¥  ì½”ë“œ

*/

@PostMapping(value = "/items/{itemId}/edit")

public String updateItem(@PathVariable Long itemId, @ModelAttribute("form")
BookForm form) {

itemService.updateItem(itemId, form.getName(), form.getPrice(),


form.getStockQuantity());

return "redirect:/items";

}

}

```

```

package jpabook.jpashop.service;

@Service
@RequiredArgsConstructor
public                       class ItemService {

private final ItemRepository itemRepository;

/**

* ì˜ì†ì„±  ì»¨í…ìŠ¤íŠ¸ê°€  ìë™  ë³€ê²½

*/
@Transactional

public void updateItem(Long id, String name, int price, int stockQuantity) {
Item item = itemRepository.findOne(id);

item.setName(name);
item.setPrice(price);
item.setStockQuantity(stockQuantity);

}

}

```

ìƒí’ˆ ì£¼ë¬¸

**ìƒí’ˆ ì£¼ë¬¸ ì»¨íŠ¸ë¡¤ëŸ¬**

```

package jpabook.jpashop.web;

import jpabook.jpashop.domain.Member;
import jpabook.jpashop.domain.Order;
import jpabook.jpashop.domain.OrderSearch;
import jpabook.jpashop.domain.item.Item;

import jpabook.jpashop.service.ItemService;
import jpabook.jpashop.service.MemberService;
import jpabook.jpashop.service.OrderService;
import lombok.RequiredArgsConstructor;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;


import org.springframework.web.bind.annotation.*;
import java.util.List;

@Controller
@RequiredArgsConstructor
public                           class OrderController {

private final OrderService orderService;
private final MemberService memberService;
private final ItemService itemService;

@GetMapping(value = "/order")

public String createForm(Model model) {

List<Member> members = memberService.findMembers();
List<Item> items = itemService.findItems();

model.addAttribute("members", members);
model.addAttribute("items", items);

return "order/orderForm";

}

@PostMapping(value = "/order")

public String order(@RequestParam("memberId") Long memberId,
@RequestParam("itemId") Long itemId, @RequestParam("count") int count) {

orderService.order(memberId, itemId, count);
return "redirect:/orders";

}

}

```

**ì£¼ë¬¸ í¼ ì´ë™**

ë©”ì¸ í™”ë©´ì—ì„œ ìƒí’ˆ ì£¼ë¬¸ì„ ì„ íƒí•˜ë©´ /order ë¥¼ GET ë°©ì‹ìœ¼ë¡œ í˜¸ì¶œ

OrderController ì˜ createForm() ë©”ì„œë“œ

ì£¼ë¬¸ í™”ë©´ì—ëŠ” ì£¼ë¬¸í•  ê³ ê°ì •ë³´ì™€ ìƒí’ˆ ì •ë³´ê°€ í•„ìš”í•˜ë¯€ë¡œ model ê°ì²´ì— ë‹´ì•„ì„œ ë·°ì— ë„˜ê²¨ì¤Œ

**ì£¼ë¬¸ ì‹¤í–‰**

ì£¼ë¬¸í•  íšŒì›ê³¼ ìƒí’ˆ ê·¸ë¦¬ê³  ìˆ˜ëŸ‰ì„ ì„ íƒí•´ì„œ Submit ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ /order URLì„ POST ë°©ì‹ìœ¼ë¡œ í˜¸ì¶œ


ì»¨íŠ¸ë¡¤ëŸ¬ì˜ order() ë©”ì„œë“œë¥¼ ì‹¤í–‰

ğŸ•” ë©”ì„œë“œëŠ” ê³ ê° ì‹ë³„ì( memberId ), ì£¼ë¬¸í•  ìƒí’ˆ ì‹ë³„ì( itemId ), ìˆ˜ëŸ‰( count ) ì •ë³´ë¥¼ ë°›ì•„ì„œ ì£¼ë¬¸ ì„œë¹„
ìŠ¤ì— ì£¼ë¬¸ì„ ìš”ì²­

ì£¼ë¬¸ğŸ•” ëë‚˜ë©´ ìƒí’ˆ ì£¼ë¬¸ ë‚´ì—­ğŸ•” ìˆëŠ” /orders URLë¡œ ë¦¬ë‹¤ğŸ•”ë ‰íŠ¸

ìƒí’ˆ ì£¼ë¬¸ í¼( order/orderForm )

```html

<!DOCTYPE HTML>

<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="fragments/header :: header" />

<body>

<div class="container">

<div th:replace="fragments/bodyHeader :: bodyHeader"/>

<form role="form" action="/order" method="post">

<div class="form-group">

<label for="member">ì£¼ë¬¸íšŒì›</label>

<select name="memberId" id="member" class="form-control">

<option value="">íšŒì›ì„ íƒ</option>

<option th:each="member : ${members}"
th:value="${member.id}"
th:text="${member.name}"                             />

</select>

</div>

<div class="form-group">

<label for="item">ìƒí’ˆëª…</label>

<select name="itemId" id="item" class="form-control">

<option value="">ìƒí’ˆì„ íƒ</option>

<option th:each="item : ${items}"
th:value="${item.id}"
th:text="${item.name}"                         />

</select>

</div>

<div class="form-group">

<label for="count">ì£¼ë¬¸ìˆ˜ëŸ‰</label>

<input type="number" name="count" class="form-control" id="count"
placeholder="ì£¼ë¬¸  ìˆ˜ëŸ‰ì„  ì…ë ¥í•˜ì„¸ìš”">

</div>


<button type="submit" class="btn btn-primary">Submit</button>

</form>

<br/>

<div th:replace="fragments/footer :: footer" />

</div> <!-- /container -->

</body>

</html>

```

ì£¼ë¬¸ ëª©ë¡ ê²€ìƒ‰, ì·¨ì†Œ

**ì£¼ë¬¸ ëª©ë¡ ê²€ìƒ‰ ì»¨íŠ¸ë¡¤ëŸ¬**

```

package jpabook.jpashop.web;

@Controller
@RequiredArgsConstructor
public                           class OrderController {

@GetMapping(value = "/orders")

public String orderList(@ModelAttribute("orderSearch") OrderSearch
orderSearch, Model model) {

List<Order> orders = orderService.findOrders(orderSearch);
model.addAttribute("orders", orders);

return "order/orderList";

}

}

```

ì£¼ë¬¸ ëª©ë¡ ê²€ìƒ‰ í™”ë©´( order/orderList )

```html

<!DOCTYPE HTML>

<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="fragments/header :: header"/>

<body>

<div class="container">


<div th:replace="fragments/bodyHeader :: bodyHeader"/>

<div>

<div>

<form th:object="${orderSearch}" class="form-inline">

<div class="form-group mb-2">

<input type="text" th:field="*{memberName}" class="form-
control" placeholder="íšŒì›ëª…"/>

</div>

<div class="form-group mx-sm-1 mb-2">

<select th:field="*{orderStatus}" class="form-control">

<option value="">ì£¼ë¬¸ìƒíƒœ</option>

<option th:each=

"status : ${T(jpabook.jpashop.domain.OrderStatus).values()}"
th:value="${status}"
th:text="${status}">option

</option>

</select>

</div>

<button type="submit" class="btn btn-primary mb-2">ê²€ìƒ‰</button>

</form>

</div>

<table class="table table-striped">

<thead>

<tr>

<th>#</th>

<th>íšŒì›ëª…</th>

<th>ëŒ€í‘œìƒí’ˆ  ğŸ•”ë¦„</th>

<th>ëŒ€í‘œìƒí’ˆ  ì£¼ë¬¸ê°€ê²©</th>

<th>ëŒ€í‘œìƒí’ˆ  ì£¼ë¬¸ìˆ˜ëŸ‰</th>

<th>ìƒíƒœ</th>

<th>ì¼ì‹œ</th>

<th></th>

</tr>

</thead>

<tbody>

<tr th:each="item : ${orders}">

<td th:text="${item.id}"></td>

<td th:text="${item.member.name}"></td>

<td th:text="${item.orderItems[0].item.name}"></td>

<td th:text="${item.orderItems[0].orderPrice}"></td>

<td th:text="${item.orderItems[0].count}"></td>


<td th:text="${item.status}"></td>

<td th:text="${item.orderDate}"></td>

<td>

<a th:if="${item.status.name() == 'ORDER'}" href="#"
th:href="'javascript:cancel('+${item.id}+')'"

class="btn btn-danger">CANCEL</a>

</td>

</tr>

</tbody>

</table>

</div>

<div th:replace="fragments/footer :: footer"/>

</div> <!-- /container -->

</body>

<script>

function cancel(id) {

var form = document.createElement("form");
form.setAttribute("method", "post");
form.setAttribute("action",           "/orders/" + id + "/cancel");
document.body.appendChild(form);

form.submit();

}

</script>

</html>

```

ì£¼ë¬¸ ì·¨ì†Œ

```

package jpabook.jpashop.web;

@Controller
@RequiredArgsConstructor
public                           class OrderController {

@PostMapping(value = "/orders/{orderId}/cancel")

public String cancelOrder(@PathVariable("orderId") Long orderId) {
orderService.cancelOrder(orderId);


}

```

return "redirect:/orders";

}


0. ì‹¤ì „! ìŠ¤í”„ë§ ë¶€íŠ¸ì™€ JPA í™œìš©1 - ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œ

v2023-12-04

#1.ì¸ê°•/jpaí™œìš©í¸/í™œìš©í¸1/ê°•ì˜

**ì¸í”„ëŸ° ê°•ì˜**

**ì €ì: ê¹€ì˜í•œ**

ëª©ì°¨

1. í”„ë¡œì íŠ¸ í™˜ê²½ì„¤ì •

2. ë„ë©”ì¸ ë¶„ì„ ì„¤ê³„

3. ì• í”Œë¦¬ì¼€ğŸ•”ì…˜ êµ¬í˜„ ì¤€ë¹„

4. íšŒì› ë„ë©”ì¸ ê°œë°œ

5. ìƒí’ˆ ë„ë©”ì¸ ê°œë°œ

6. ì£¼ë¬¸ ë„ë©”ì¸ ê°œë°œ

7. ì›¹ ê³„ì¸µ ê°œë°œ

ë²„ì „ ìˆ˜ì • ì´ë ¥

v2023-12-04

ìŠ¤í”„ë§ ë¶€íŠ¸ 3.2 Gradle ë¹Œë“œ, JDK 17 ì„ íƒ ì„¤ëª… ì¶”ê°€

v2023-11-27

ìŠ¤í”„ë§ ë¶€íŠ¸ 3.2 ì—…ë°ğŸ•”íŠ¸ ê´€ë ¨ ğŸ•”ìŠˆ
start.spring.io ìŠ¤í”„ë§ ë¶€íŠ¸ 2.x ì§€ì› ì¢…ë£Œ
ìŠ¤í”„ë§ ë¶€íŠ¸ 3.0 ğŸ•”ìƒì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”.
ìë°” 17 ğŸ•”ìƒì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”.

ê°•ì˜ ë©”ë‰´ì–¼ ë¶„í• 
ê°•ì˜ ë©”ë‰´ì–¼ ë§í¬

v2023-05-26

ìŠ¤í”„ë§ ë¶€íŠ¸ 3.0 - p6spy 1.9.0 ì‚¬ìš©(DH Lë‹˜ ë„ì›€)
ì˜¤íƒ€ ìˆ˜ì •(ë¡œì˜´ë‹˜, qwerty jonë‹˜, YOGURTë‹˜ ë„ì›€)

v2023-01-03


ìŠ¤í”„ë§ ë¶€íŠ¸ 3.0 - p6spy ì¶”ê°€
ì½”ë“œ ì˜¤íƒ€ ìˆ˜ì •(ë©ëƒ¥ì—„ë§ˆë‹˜ ë„ì›€)

v2022-12-08

ìŠ¤í”„ë§ ë¶€íŠ¸ 3.0 - ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ë¡œê·¸ ë‚¨ê¸°ê¸°, hibernate6 JPA SQL ë°”ì¸ë”© ë¡œê·¸ ì¶”ê°€

v2022-11-28

ìŠ¤í”„ë§ ë¶€íŠ¸ 3.0 ë‚´ìš© ì¶”ê°€

í”„ë¡œì íŠ¸ ì„ íƒì—ì„œ Gradle - Groovy ì¶”ê°€

v2022-05-08

html íŒŒì¼ ë§í¬ ìˆ˜ì •(ë„ì›€ì£¼ì‹  ë¶„ Catnipë‹˜)

ì½”ë“œ ì˜¤íƒ€ ìˆ˜ì •(Jenny Kimë‹˜ ë„ì›€)

ì½”ë“œ ì˜¤íƒ€ ìˆ˜ì • itemParam     item(íŒŒğŸ•”í›„ë‹˜ ë„ì›€)
ì½”ë“œ ì˜¤íƒ€ ìˆ˜ì • team     member(ìš°í•˜í•˜í•˜í—¤í—¤ë‹˜ ë„ì›€)

v2021-07-28

ì¬ê³  ìˆ˜ì • ì½”ë“œ ëˆ„ë½ ìˆ˜ì •

v2.1 - 2020-12-27

ìŠ¤í”„ë§ ë¶€íŠ¸ ë²„ì „ ì—… 2.3.x     2.4.x
junit4 ì ìš© ë°©ë²• ë³€ê²½

v2.0 - 2020-11-09

ìŠ¤í”„ë§ ë¶€íŠ¸ ìµœì‹  ë²„ì „ ì‚¬ìš© 2.1.x     2.3.x

ìë°” ë²„ì „ 8     11 ì‚¬ìš©

v1.13 - 2020-10-29

OrderServiceì—ì„œ itemService     itemRepositoryë¡œ ìˆ˜ì •

v1.12 - 2020-10-15

${T(jpabook...) ë¶€ë¶„ ë„ì–´ì“°ê¸° PDF ì˜¤ë¥˜ ìˆ˜ì •

v1.11 - 2020-10-08

junit5ì—ì„œ ì‹¤í–‰ì‹œ í…ŒìŠ¤íŠ¸ ì—†ëŠ” ì˜¤ë¥˜ ë³´ì¶© ì„¤ëª…

v1.10 - 2020-10-01

íšŒì› ì—”í‹°í‹° ë¶„ì„ ê·¸ë¦¼: Order     Delivery ë‹¨ë°©í–¥ì„ ì–‘ë°©í–¥ìœ¼ë¡œ ìˆ˜ì •

v1.9 - 2020-09-04

yml ë„ì–´ì“°ê¸° ì£¼ì˜ ë‚´ìš© ì¶”ê°€

v1.8 - 2020-08-12


H2 ë°ğŸ•”í„°ë² ğŸ•”ìŠ¤ ë²„ì „ ê¸°ë³¸ì„ 1.4.199     **1.4.200ìœ¼ë¡œ ì‚¬ìš©**

v1.7 - 2020-06-30

H2 ë°ğŸ•”í„°ë² ğŸ•”ìŠ¤ ë²„ì „ 1.4.200     1.4.199ë¡œ ë²„ì „ ì§€ì • ë‚´ìš© ì¶”ê°€

v1.6 - 2020-06-11

updateItemForm.html ì— isbn, submit ëˆ„ë½ ìˆ˜ì •
ë„ì›€ì£¼ì‹  ë¶„: OMG

v1.5 - 2020-05-22

form-control ë³µì‚¬ ë¶™ğŸ•”ê¸° ğŸ•”ìŠˆ ì¶”ê°€

v1.4 - 2020-05-08

ìŠ¤í”„ë§ ë¶€íŠ¸ 2.1.x ë²„ì „ì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”.

v1.3 - 2020-01-06

**H2 ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì¹˜**

MVCC ì˜µì…˜ ì œê±°

v1.2 - 2020-01-03

**IntelliJ Gradle ëŒ€ì‹ ì— ìë°” ì§ì ‘ ì‹¤í–‰**

ë‚´ìš© ì¶”ê°€

**ì£¼ë¬¸ì„œë¹„ìŠ¤ê°œë°œ ì½”ë“œ ë³´ì¶©**

delivery.setStatus(DeliveryStatus.READY); ì½”ë“œ ì¶”ê°€
ë„ì›€ì£¼ì‹  ë¶„: ê°•í”„ë¡œê·¸ë˜ë¨¸

v1.1 - 2019-10-30

**ìŠ¤í”„ë§ ë¶€íŠ¸ ë²„ì „ ë³€ê²½**

2.1.6     2.1.9

**H2 ë°ì´í„°ë² ì´ìŠ¤ ë²„ì „ ëª…ì‹œ**

Version 1.4.199ì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”.

**ë„ë©”ì¸ ëª¨ë¸ê³¼ í…Œì´ë¸” ì„¤ê³„.ì—°ê´€ê´€ê³„ ë§¤í•‘ ë¶„ì„**

ë„ì›€ì£¼ì‹  ë¶„: ì—´ì‹¬

ê¸°ì¡´: **ì£¼ë¬¸ê³¼ ë°°ì†¡:**                   ì¼ëŒ€ì¼ ë‹¨ë°©í–¥ ê´€ê³„ë‹¤.  Order.delivery ë¥¼ ORDERS.DELIVERY_ID ì™¸ë˜ í‚¤ì™€ ë§¤í•‘í•œ
ë‹¤.

ë³€ê²½: **ì£¼ë¬¸ê³¼ ë°°ì†¡:**                   ì¼ëŒ€ì¼ ì–‘ë°©í–¥ ê´€ê³„ë‹¤.  Order.delivery ë¥¼ ORDERS.DELIVERY_ID ì™¸ë˜ í‚¤ì™€ ë§¤í•‘í•œ
ë‹¤.

